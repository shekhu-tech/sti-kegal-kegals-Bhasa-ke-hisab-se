<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>S.T.I-KEGEL PRO 2025 | Next-Gen Pelvic Health</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800;900&family=Plus+Jakarta+Sans:wght@500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ================= PRO THEME VARIABLES ================= */
        :root {
            --primary: #FFD700;       
            --primary-dim: rgba(255, 215, 0, 0.15); 
            --gold-glow: 0 0 35px rgba(255, 215, 0, 0.35);
            --bg-deep: #030304;
            --bg-card: rgba(15, 15, 20, 0.75); 
            --header-h: 72px;
            --footer-h: 85px;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        /* Global Reset */
        html, body {
            height: 100%; width: 100%; overflow: hidden;
            background-color: var(--bg-deep);
            color: #fff;
            font-family: 'Plus Jakarta Sans', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .font-cyber { font-family: 'Rajdhani', sans-serif; text-transform: uppercase; letter-spacing: 1.5px; }
        .font-mono-tech { font-family: 'JetBrains Mono', monospace; letter-spacing: -0.5px; }

        /* PRO Background FX */
        .bg-fx {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: 
                radial-gradient(circle at 50% 30%, rgba(255, 215, 0, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 90% 90%, rgba(255, 215, 0, 0.03) 0%, transparent 40%),
                linear-gradient(to bottom, #000000 0%, #050507 100%);
            pointer-events: none;
        }

        /* Animations */
        @keyframes subtlePulse {
            0% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.1); border-color: rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 0 25px rgba(255, 215, 0, 0.3); border-color: rgba(255, 215, 0, 0.6); }
            100% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.1); border-color: rgba(255, 215, 0, 0.3); }
        }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* ================= PRO UI COMPONENTS ================= */
        
        /* HEADER */
        .cyber-header {
            position: fixed; top: calc(15px + var(--safe-top)); 
            left: 50%; transform: translateX(-50%);
            width: 94%; max-width: 600px; height: var(--header-h);
            background: rgba(10, 10, 10, 0.6); 
            backdrop-filter: blur(25px) saturate(180%);
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-top: 1px solid rgba(255, 215, 0, 0.4); 
            border-radius: 24px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 12px; z-index: 50;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), inset 0 0 20px rgba(255, 215, 0, 0.03);
            animation: subtlePulse 4s infinite ease-in-out;
        }

        .brand-logo-img { 
            height: 42px; width: auto; 
            object-fit: contain; 
            filter: drop-shadow(0 0 12px rgba(255, 215, 0, 0.5));
            transition: transform 0.3s ease;
        }

        .header-icon {
            width: 48px; height: 48px; border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.08);
            display: flex; align-items: center; justify-content: center;
            background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.01));
            overflow: hidden; padding: 0;
            box-shadow: inset 0 1px 1px rgba(255,255,255,0.1);
        }
        .side-icon-img { width: 100%; height: 100%; object-fit: cover; opacity: 0.9; }

        /* DOCK */
        .cyber-dock-wrapper {
            position: fixed; bottom: calc(20px + var(--safe-bottom)); left: 0; width: 100%;
            display: flex; justify-content: center; z-index: 60; pointer-events: none;
        }
        .cyber-dock {
            pointer-events: auto;
            background: rgba(5, 5, 7, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 215, 0, 0.15);
            border-radius: 35px; height: var(--footer-h);
            display: flex; align-items: center; justify-content: space-evenly;
            padding: 0 10px; width: 94%; max-width: 500px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.9);
        }
        .dock-item {
            width: 55px; height: 55px; border-radius: 18px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: rgba(255,255,255,0.25); transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); cursor: pointer;
        }
        .dock-item:hover, .dock-item.active-tab { 
            color: #FFD700; 
            background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%);
            transform: translateY(-2px);
        }
        .dock-item i { font-size: 1.3rem; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }

        .reactor-core {
            width: 80px; height: 80px; border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #333, #000);
            border: 1px solid rgba(255,215,0,0.5);
            box-shadow: 0 0 30px rgba(255,215,0,0.2), inset 0 0 15px rgba(0,0,0,0.8);
            transform: translateY(-30px);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; z-index: 60; cursor: pointer;
            transition: transform 0.2s;
        }
        .reactor-core:active { transform: translateY(-28px) scale(0.95); }
        .reactor-core::after {
            content: ''; position: absolute; inset: -4px; border-radius: 50%;
            border: 2px dashed rgba(255,215,0,0.2); animation: spin 12s linear infinite;
        }
        .reactor-day { font-family: 'Rajdhani'; font-size: 2.2rem; font-weight: 800; line-height: 1; color: #fff; text-shadow: 0 0 15px var(--primary); }
        .reactor-label { font-size: 0.55rem; color: var(--primary); font-family: 'JetBrains Mono'; font-weight: 700; letter-spacing: 1px; }

        /* GLASS PANEL */
        .glass-panel {
            background: var(--bg-card);
            backdrop-filter: blur(40px) saturate(150%);
            -webkit-backdrop-filter: blur(40px) saturate(150%);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 30px 60px -10px rgba(0, 0, 0, 0.9), inset 0 1px 1px rgba(255, 255, 255, 0.1);
            position: fixed;
            top: calc(var(--header-h) + 25px + var(--safe-top));
            bottom: calc(var(--footer-h) + 20px + var(--safe-bottom));
            left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 500px;
            border-radius: 32px;
            display: flex; flex-direction: column;
            overflow: hidden; z-index: 10;
        }

        /* Module Popups */
        .module-popup {
            position: absolute; inset: 0;
            background: linear-gradient(180deg, rgba(20,20,25,0.95) 0%, rgba(10,10,12,0.98) 100%);
            z-index: 20; 
            display: flex; flex-direction: column;
            opacity: 0; pointer-events: none; transform: scale(0.96);
            transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .module-popup.active { opacity: 1; pointer-events: auto; transform: scale(1); }

        /* Scroll Area */
        .content-scroll-area { flex: 1; overflow-y: auto; padding: 1.5rem; scrollbar-width: none; mask-image: linear-gradient(to bottom, transparent, black 20px, black 95%, transparent); -webkit-mask-image: linear-gradient(to bottom, transparent, black 20px, black 95%, transparent); }
        .content-scroll-area::-webkit-scrollbar { display: none; }

        /* BUTTONS */
        .btn-tech {
            background: linear-gradient(145deg, rgba(255,255,255,0.06) 0%, rgba(255,255,255,0.02) 100%);
            border: 1px solid rgba(255,255,255,0.08);
            transition: all 0.3s;
            position: relative; overflow: hidden;
        }
        .btn-tech:hover { border-color: var(--primary); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        
        .btn-primary-glow {
            background: linear-gradient(135deg, #FFD700 0%, #E6C200 100%);
            color: #000; font-weight: 800; border: none;
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.3); 
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .btn-primary-glow:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.5); 
            background: #fff;
        }

        /* --- STRICT DISABLED STATE FOR VIDEO BUTTON --- */
        button:disabled {
            opacity: 0.4 !important;
            cursor: not-allowed !important;
            filter: grayscale(1) !important;
            box-shadow: none !important;
            transform: none !important;
            background: #333 !important;
            color: #888 !important;
        }

        .input-tech {
            background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.15);
            color: #fff; font-family: 'JetBrains Mono'; width: 100%;
            padding: 18px; border-radius: 16px; outline: none;
            transition: 0.3s; text-align: center; font-size: 1.3rem;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
        }
        .input-tech:focus { border-color: var(--primary); box-shadow: 0 0 20px rgba(255,215,0,0.15); background: rgba(0,0,0,0.6); }

        /* HUD Boxes */
        .hud-box { 
            position: relative; 
            background: linear-gradient(180deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
            border: 1px solid rgba(255,255,255,0.08); 
            backdrop-filter: blur(5px);
        }
        .hud-box::after { content: ''; position: absolute; bottom: -1px; right: -1px; width: 8px; height: 8px; border-bottom: 2px solid var(--primary); border-right: 2px solid var(--primary); opacity: 0.7; }
        .hud-box::before { content: ''; position: absolute; top: -1px; left: -1px; width: 8px; height: 8px; border-top: 2px solid var(--primary); border-left: 2px solid var(--primary); opacity: 0.7; }

        /* Exercise Cards */
        .exercise-card { 
            background: linear-gradient(180deg, rgba(30,30,35,0.6) 0%, rgba(20,20,25,0.4) 100%);
            border: 1px solid rgba(255,255,255,0.05); 
            transition: all 0.3s ease;
        }
        .exercise-card.current { 
            border: 1px solid rgba(255, 215, 0, 0.4); 
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.08) 0%, rgba(0,0,0,0) 100%);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            transform: scale(1.02);
        }
        .exercise-card.completed { border-color: #10b981; opacity: 0.5; filter: saturate(0.5); }
        .exercise-card.locked { 
            opacity: 0.2; 
            filter: grayscale(1); 
            pointer-events: none; 
            border-style: dashed;
        }

        /* Modals */
        .overlay-modal { position: fixed; inset: 0; z-index: 200; display: flex; align-items: center; justify-content: center; padding: 20px; background: rgba(0,0,0,0.85); backdrop-filter: blur(15px); }

        /* === VIDEO MODAL STYLING === */
        .video-modal-container {
            width: 100%;
            height: auto;
            max-height: 70dvh;
            margin: auto;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-radius: 16px;
            background: #000;
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
        }

        .video-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .video-player-wrapper {
            width: 100%;
            aspect-ratio: 16 / 9;
            flex-shrink: 0; 
            background: #000;
            position: relative;
            z-index: 10;
        }

        .video-info-area {
            flex: 1; 
            overflow-y: auto; 
            background: linear-gradient(to top, #000 0%, #111 100%);
            display: flex;
            flex-direction: column;
            padding: 16px;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255, 215, 0, 0.2); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255, 215, 0, 0.5); }

        /* Custom Video Player */
        .custom-video-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: relative;
        }

        .play-button-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid #FFD700;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 20;
        }

        .play-button-overlay:hover {
            background: rgba(255, 215, 0, 0.3);
            transform: translate(-50%, -50%) scale(1.1);
        }

        .play-button-overlay i {
            font-size: 2.5rem;
            color: #FFD700;
            margin-left: 5px;
        }

        .video-duration-badge {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-family: 'JetBrains Mono';
            z-index: 10;
        }

        /* Dailymotion iframe styling */
        .dailymotion-iframe-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .dailymotion-iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 8px;
        }

        /* Day library grid */
        .day-library-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .day-library-btn {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            background: rgba(255, 215, 0, 0.1);
            color: white;
            font-family: 'JetBrains Mono';
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .day-library-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.05);
        }

        .day-library-btn.completed {
            background: rgba(16, 185, 129, 0.3);
            border-color: #10b981;
        }

        .day-library-btn.current {
            background: rgba(255, 215, 0, 0.3);
            border-color: #FFD700;
            animation: subtlePulse 2s infinite;
        }

        .day-library-btn.locked {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.3);
            cursor: not-allowed;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <div class="bg-fx"></div>

    <header class="cyber-header">
        <div class="header-icon">
            <img src="sti.png" alt="Menu" class="side-icon-img">
        </div>
        <img src="stiprocenter.png" alt="APP LOGO" class="brand-logo-img">
        <div class="header-icon">
            <img src="stipro.png" alt="Profile" class="side-icon-img">
        </div>
    </header>

    <div class="glass-panel animate-fade-in">
        
        <div id="name-input-section" class="module-popup flex flex-col items-center justify-center p-6 text-center z-50">
            <img src="sti.png" alt="Logo" class="mb-8 animate-pulse" style="height: 60px; width: auto; filter: drop-shadow(0 0 20px rgba(255,215,0,0.6));">
            <h2 class="text-3xl font-cyber font-bold text-white mb-2 tracking-widest"><br>WELCOME</h2>
            <p class="text-gray-400 text-xs font-mono-tech mb-10 tracking-wider">TO-STI-WORLD</p>
            <input type="text" id="user-name-field" class="input-tech mb-8" placeholder="CALLSIGN..." autocomplete="off">
            <button onclick="submitName()" class="w-full btn-primary-glow py-4 rounded-2xl font-cyber font-bold text-lg tracking-widest">
                ACCESS PROTOCOL <i class="fas fa-chevron-right ml-2 text-xs"></i>
            </button>
        </div>

        <main id="app-content" class="h-full flex flex-col relative z-10">
            <div class="content-scroll-area">
                
                <div id="progress-section" class="mb-8 mt-4 hidden">
                    <div class="flex justify-between items-end mb-2 font-mono-tech">
                        <span class="text-[10px] text-[#FFD700] tracking-widest uppercase flex items-center gap-2">
                            <span class="w-1.5 h-1.5 bg-[#FFD700] rounded-full animate-pulse"></span> ANALYSIS RUNNING
                        </span>
                        <span id="question-counter" class="text-xs text-white/50">00/00</span>
                    </div>
                    <div class="w-full bg-white/5 h-1 rounded-full overflow-hidden">
                        <div id="progress-bar" class="h-full bg-gradient-to-r from-[#FFD700] to-[#E6C200] w-0 transition-all duration-500 ease-out shadow-[0_0_10px_#FFD700]"></div>
                    </div>
                </div>

                <div id="quiz-section" class="flex flex-col justify-center hidden">
                    <h2 id="question-text" class="text-2xl font-bold text-white mb-8 font-cyber leading-tight">Loading Data...</h2>
                    <div id="options-container" class="space-y-4"></div>
                </div>

                <div id="main-view-section" class="hidden pb-4">
                    </div>
            </div>
        </main>

        <div id="module-profile" class="module-popup">
            <div class="p-6 h-full flex flex-col items-center justify-center text-center">
                <div class="w-28 h-28 rounded-full border border-[#FFD700] flex items-center justify-center mb-4 bg-gradient-to-b from-[#FFD700]/20 to-transparent shadow-[0_0_40px_rgba(255,215,0,0.15)] relative">
                    <div class="absolute inset-0 rounded-full border border-[#FFD700]/30 animate-ping opacity-20"></div>
                    <i class="fas fa-user-astronaut text-5xl text-white drop-shadow-lg"></i>
                </div>
                
                <h2 class="text-4xl font-cyber font-bold text-white mb-1 tracking-tighter" id="profile-name">USER</h2>
                <div class="inline-block px-4 py-1.5 bg-[#FFD700] text-black text-[10px] font-bold font-mono-tech rounded-md mb-8 shadow-[0_0_15px_rgba(255,215,0,0.4)]">OPERATOR STATUS: ACTIVE</div>

                <div class="w-full space-y-3">
                    <div class="hud-box p-4 rounded-xl flex justify-between items-center">
                        <span class="text-gray-500 text-[10px] font-mono-tech uppercase tracking-widest">Gender Bio-Lock</span>
                        <span class="text-white font-bold font-cyber text-xl" id="profile-gender">--</span>
                    </div>
                    <div class="hud-box p-4 rounded-xl flex justify-between items-center">
                        <span class="text-gray-500 text-[10px] font-mono-tech uppercase tracking-widest">Training Tier</span>
                        <span class="text-[#FFD700] font-bold font-cyber text-xl" id="profile-level">--</span>
                    </div>
                    <div class="hud-box p-4 rounded-xl flex justify-between items-center">
                        <span class="text-gray-500 text-[10px] font-mono-tech uppercase tracking-widest">Inception</span>
                        <span class="text-white font-bold font-cyber text-xl" id="profile-date">--</span>
                    </div>
                    <!-- PROBLEMS DISPLAY -->
                    <div class="hud-box p-4 rounded-xl">
                        <span class="text-gray-500 text-[10px] font-mono-tech uppercase tracking-widest block mb-2">Identified Issues</span>
                        <div id="profile-problems" class="text-white text-sm font-mono-tech text-left"></div>
                    </div>
                </div>

                <button onclick="closeAllModules()" class="mt-auto w-full btn-tech py-4 rounded-xl text-xs font-bold font-cyber text-white/40 hover:text-white uppercase tracking-widest">Close Interface</button>
            </div>
        </div>

        <div id="module-stats" class="module-popup">
            <div class="p-6 h-full flex flex-col">
                <h2 class="text-2xl font-cyber font-bold text-white mb-8 border-b border-white/10 pb-4 flex items-center justify-between">
                    <span>BIO-METRICS</span> <i class="fas fa-chart-pie text-[#FFD700] text-lg"></i>
                </h2>

                <div class="grid grid-cols-3 gap-3 mb-8">
                    <div class="hud-box p-4 rounded-xl text-center flex flex-col justify-center aspect-square">
                        <div class="text-[9px] uppercase text-gray-500 font-bold mb-1 tracking-wider">Focus</div>
                        <div id="stats-focus" class="text-2xl font-mono-tech font-bold text-[#FFD700] drop-shadow-[0_0_5px_rgba(255,215,0,0.5)]">0%</div>
                    </div>
                    <div class="hud-box p-4 rounded-xl text-center flex flex-col justify-center aspect-square">
                        <div class="text-[9px] uppercase text-gray-500 font-bold mb-1 tracking-wider">Urgency</div>
                        <div id="stats-urgency" class="text-2xl font-mono-tech font-bold text-[#ef4444] drop-shadow-[0_0_5px_rgba(239,68,68,0.5)]">0%</div>
                    </div>
                    <div class="hud-box p-4 rounded-xl text-center flex flex-col justify-center aspect-square">
                        <div class="text-[9px] uppercase text-gray-500 font-bold mb-1 tracking-wider">Protocol</div>
                        <div id="stats-program" class="text-2xl font-mono-tech font-bold text-[#06b6d4] drop-shadow-[0_0_5px_rgba(6,182,212,0.5)]">0%</div>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-white/5 to-transparent p-5 rounded-2xl border border-white/10 mb-4">
                    <h3 class="text-[10px] font-bold text-[#FFD700] mb-3 font-cyber uppercase tracking-widest"><i class="fas fa-terminal mr-2"></i>Problems</h3>
                    <p id="stats-text" class="text-xs text-gray-400 leading-relaxed font-mono-tech">
                        Awaiting data input...
                    </p>
                </div>

                <button onclick="closeAllModules()" class="mt-auto w-full btn-tech py-4 rounded-xl text-xs font-bold font-cyber text-white/40 hover:text-white uppercase tracking-widest">Close Interface</button>
            </div>
        </div>

        <div id="module-progress" class="module-popup">
            <div class="p-6 h-full flex flex-col">
                <h2 class="text-2xl font-cyber font-bold text-white mb-8 border-b border-white/10 pb-4 flex items-center justify-between">
                    <span>DAY LIBRARY</span> <i class="fas fa-tasks text-[#FFD700] text-lg"></i>
                </h2>

                <div class="flex items-center gap-6 mb-6 bg-white/5 p-4 rounded-2xl border border-white/5">
                    <div class="w-20 h-20 rounded-full flex items-center justify-center relative">
                         <svg class="absolute inset-0 w-full h-full transform -rotate-90 filter drop-shadow-[0_0_8px_rgba(255,215,0,0.3)]">
                             <circle cx="40" cy="40" r="36" stroke="rgba(255,255,255,0.05)" stroke-width="6" fill="transparent" />
                             <circle id="progress-ring" cx="40" cy="40" r="36" stroke="#FFD700" stroke-width="6" fill="transparent" stroke-dasharray="226" stroke-dashoffset="226" stroke-linecap="round" />
                         </svg>
                         <span class="text-sm font-bold font-mono-tech text-white" id="progress-percent">0%</span>
                    </div>
                    <div>
                        <div class="text-[10px] text-gray-400 font-mono-tech uppercase mb-1 tracking-wider">Current Phase</div>
                        <div class="text-2xl font-bold font-cyber text-white tracking-wide" id="progress-phase">INITIATION</div>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="text-xs font-bold text-[#FFD700] mb-3 font-cyber uppercase tracking-widest">Training Days</h3>
                    <div class="day-library-grid" id="day-library-grid">
                        <!-- Day buttons will be generated here -->
                    </div>
                </div>

                <div class="space-y-4 overflow-y-auto pr-2 custom-scrollbar flex-1">
                    <div class="flex justify-between items-center text-xs border-b border-white/5 pb-3">
                        <span class="text-gray-500 font-mono-tech">DAYS COMPLETED</span>
                        <span class="text-white font-bold font-cyber text-lg" id="progress-days">0 / 30</span>
                    </div>
                    <div class="flex justify-between items-center text-xs border-b border-white/5 pb-3">
                        <span class="text-gray-500 font-mono-tech">TOTAL SESSIONS</span>
                        <span class="text-white font-bold font-cyber text-lg" id="progress-exercises">0</span>
                    </div>
                </div>

                <button onclick="closeAllModules()" class="mt-auto w-full btn-tech py-4 rounded-xl text-xs font-bold font-cyber text-white/40 hover:text-white uppercase tracking-widest">Close Interface</button>
            </div>
        </div>

    </div>

    <div class="cyber-dock-wrapper">
        <nav class="cyber-dock">
            <div class="dock-item" onclick="openModule('profile')">
                <i class="fas fa-user-astronaut"></i>
            </div>
            
            <div class="dock-item" onclick="openModule('stats')">
                <i class="fas fa-chart-simple"></i>
            </div>

            <div class="reactor-core active" onclick="closeAllModules()">
                <span class="reactor-day" id="core-day">01</span>
                <span class="reactor-label">DAY</span>
            </div>

            <div class="dock-item" onclick="openModule('progress')">
                <i class="fas fa-list-check"></i>
            </div>
            
            <div class="dock-item" onclick="restartAssessment()">
                <i class="fas fa-power-off"></i>
            </div>
        </nav>
    </div>

    <div id="custom-alert-modal" class="overlay-modal hidden">
        <div class="relative bg-[#0a0a0c] border border-[#FFD700] p-8 rounded-2xl max-w-sm w-full shadow-[0_0_80px_rgba(255,215,0,0.15)] text-center">
            <div class="text-[#FFD700] text-4xl mb-4 drop-shadow-[0_0_15px_rgba(255,215,0,0.6)]"><i class="fas fa-triangle-exclamation"></i></div>
            <h3 class="text-white font-bold text-2xl mb-2 font-cyber tracking-widest">SYSTEM RESET</h3>
            <p class="text-gray-400 text-xs mb-8 font-mono-tech leading-relaxed">CRITICAL WARNING: ALL PROGRESS DATA WILL BE PERMANENTLY PURGED.<br><span class="text-[#ef4444] font-bold">CONFIRM DELETION?</span></p>
            <div class="flex gap-4">
                <button onclick="document.getElementById('custom-alert-modal').classList.add('hidden')" class="flex-1 py-4 rounded-xl border border-white/10 text-white text-xs font-bold hover:bg-white/5 font-cyber tracking-widest">ABORT</button>
                <button onclick="confirmReset()" class="flex-1 py-4 rounded-xl bg-[#FFD700] text-black text-xs font-bold hover:bg-white font-cyber tracking-widest shadow-[0_0_20px_rgba(255,215,0,0.3)]">CONFIRM</button>
            </div>
        </div>
    </div>

    <div id="video-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="absolute top-0 left-0 right-0 bottom-0 bg-black/95 backdrop-blur-xl transition-opacity duration-300" 
             style="top: calc(var(--header-h) + 25px + var(--safe-top)); bottom: calc(var(--footer-h) + 20px + var(--safe-bottom));"
             onclick="closeVideoModal()"></div>
        
        <div class="video-modal-container z-10 relative animate-fade-in max-w-md">
            
            <div class="video-container">
                <button onclick="closeVideoModal()" class="absolute top-2 right-2 z-20 w-8 h-8 flex items-center justify-center bg-black/50 rounded-full text-white/70 hover:text-white hover:bg-black/80 transition-all border border-white/10">
                    <i class="fas fa-times"></i>
                </button>

                <div class="video-player-wrapper" id="video-frame">
                    <!-- Dailymotion iframe will be inserted here -->
                </div>
                
                <div class="video-info-area custom-scrollbar">
                    
                    <div class="video-progress h-1 bg-white/10 rounded-full mb-3 overflow-hidden shrink-0">
                        <div id="video-progress-fill" class="h-full bg-[#FFD700] w-0 transition-all duration-300 shadow-[0_0_10px_#FFD700]"></div>
                    </div>
                    
                    <div class="flex justify-between text-[10px] font-mono-tech text-gray-400 mb-4 shrink-0">
                        <span id="video-time-current">0:00</span>
                        <span id="video-time-total">0:00</span>
                    </div>

                    <h3 id="video-title" class="text-base font-bold text-white mb-1 leading-tight"></h3>
                    <p id="video-description" class="text-xs text-gray-400 mb-4 leading-relaxed"></p>
                    
                    <div class="grid grid-cols-3 gap-2 mb-5 shrink-0">
                        <div class="bg-white/5 p-2 rounded text-center border border-white/5">
                            <i class="fas fa-clock text-[#FFD700] text-[10px] mb-1 block"></i>
                            <span id="video-duration" class="text-[10px] font-mono-tech"></span>
                        </div>
                        <div class="bg-white/5 p-2 rounded text-center border border-white/5">
                            <i class="fas fa-redo text-[#FFD700] text-[10px] mb-1 block"></i>
                            <span id="video-reps" class="text-[10px] font-mono-tech"></span>
                        </div>
                        <div class="bg-white/5 p-2 rounded text-center border border-white/5">
                            <i class="fas fa-tag text-[#FFD700] text-[10px] mb-1 block"></i>
                            <span id="video-category" class="text-[9px] uppercase font-bold truncate"></span>
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mb-4">
                        <button id="repeat-btn" onclick="repeatVideo()" class="flex-1 btn-tech py-3 rounded-xl text-xs font-bold disabled:opacity-50 disabled:cursor-not-allowed transition-all shrink-0">
                            <i class="fas fa-redo mr-2"></i>
                            <span>REPEAT VIDEO</span>
                        </button>
                        <button id="complete-btn" onclick="markCurrentExerciseComplete()" class="flex-1 btn-primary-glow py-3 rounded-xl text-xs font-bold disabled:opacity-50 disabled:cursor-not-allowed transition-all shrink-0">
                            <i class="fas fa-circle-notch fa-spin mr-2 hidden" id="video-loading"></i>
                            <span id="complete-btn-text">IN PROGRESS...</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    // ==================== DATA & STATE ====================
    let appState = {
        name: null,
        currentQuestion: 0,
        gender: null,
        scores: { leakage: 0, pain: 0, sexual: 0, strength: 0, control: 0 },
        categoryScores: { demographic: 0, symptoms: 0, lifestyle: 0, sexual: 0, experience: 0, goals: 0, medical: 0 },
        assessmentComplete: false,
        currentDay: 1,
        startDate: new Date().toLocaleDateString(),
        dayExercises: {}, dayProgress: {},
        lastSave: Date.now(),
        identifiedProblems: [], // Store identified problems
        userAnswers: {} // Store user answers for problem detection
    };

    // ==================== OPTIMIZED EXERCISE LIBRARY (10 PER CATEGORY) ====================
    const exerciseLibrary = {
        foundational: [
            { id:"F1",name:"Classic Hold Kegel",description:"Basic contraction hold for muscle identification",category:"foundational",subcategory:"slow",difficulty:"beginner",duration:"2:45",reps:"10 × 5s",videoCode:"x9x5uzi",benefit:"Identifies pelvic floor muscles.",solution:"Builds awareness.",gender:"both",thumbnail:"F1"},
            { id:"F2",name:"Timed Hold Progression",description:"Gradual increase in hold duration",category:"foundational",subcategory:"slow",difficulty:"beginner",duration:"3:10",reps:"8 progressions",videoCode:"x9x5uzi",benefit:"Improves endurance safely.",solution:"Progressive overload.",gender:"both",thumbnail:"F2"},
            { id:"F3",name:"Quick Flick Kegels",description:"Rapid short contractions",category:"foundational",subcategory:"fast",difficulty:"beginner",duration:"2:20",reps:"20 reps",videoCode:"x9x5uzi",benefit:"Improves reaction time.",solution:"Trains fast-twitch fibers.",gender:"both",thumbnail:"F3"},
            { id:"F4",name:"Pulse Kegels",description:"Rhythmic pulsing contractions",category:"foundational",subcategory:"fast",difficulty:"beginner",duration:"3:00",reps:"15 pulses",videoCode:"x9x5uzi",benefit:"Improves tone.",solution:"Enhances circulation.",gender:"both",thumbnail:"F4"},
            { id:"F5",name:"Micro Contractions",description:"Small precise engagements",category:"foundational",subcategory:"fast",difficulty:"beginner",duration:"2:50",reps:"25 reps",videoCode:"x9x5uzi",benefit:"Improves precision.",solution:"Isolates fibers.",gender:"both",thumbnail:"F5"},
            { id:"F6",name:"Long-Hold Static",description:"Extended static holds",category:"foundational",subcategory:"slow",difficulty:"intermediate",duration:"4:15",reps:"6 × 15s",videoCode:"x9x5uzi",benefit:"Builds endurance.",solution:"Strengthens slow fibers.",gender:"both",thumbnail:"F6"},
            { id:"F7",name:"Progressive Hold 3-5-10",description:"Step-wise hold increase",category:"foundational",subcategory:"slow",difficulty:"beginner",duration:"3:30",reps:"3 sets",videoCode:"x9x5uzi",benefit:"Structured progress.",solution:"Prevents plateau.",gender:"both",thumbnail:"F7"},
            { id:"F8",name:"Rapid Fire Series",description:"Fast consecutive contractions",category:"foundational",subcategory:"fast",difficulty:"intermediate",duration:"2:55",reps:"30 reps",videoCode:"x9x5uzi",benefit:"Improves speed.",solution:"Boosts neural drive.",gender:"both",thumbnail:"F8"},
            { id:"F9",name:"Contraction Awareness",description:"Focus on muscle sensation",category:"foundational",subcategory:"slow",difficulty:"beginner",duration:"3:15",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Mind-muscle link.",solution:"Improves technique.",gender:"both",thumbnail:"F9"},
            { id:"F10",name:"Basic Rhythm Training",description:"Consistent contraction rhythm",category:"foundational",subcategory:"fast",difficulty:"beginner",duration:"2:40",reps:"20 reps",videoCode:"x9x5uzi",benefit:"Timing control.",solution:"Establishes rhythm.",gender:"both",thumbnail:"F10"}
        ],

        strength: [
            { id:"S1",name:"Full Squeeze Max",description:"Maximum pelvic contraction hold",category:"strength",subcategory:"slow",difficulty:"intermediate",duration:"3:45",reps:"8 × 6s",videoCode:"x9x5uzi",benefit:"Builds maximum strength.",solution:"Activates full muscle fibers.",gender:"both",thumbnail:"S1"},
            { id:"S2",name:"Peak Hold Challenge",description:"High intensity peak holds",category:"strength",subcategory:"slow",difficulty:"intermediate",duration:"4:20",reps:"6 × 10s",videoCode:"x9x5uzi",benefit:"Improves peak endurance.",solution:"Sustains max contraction.",gender:"both",thumbnail:"S2"},
            { id:"S3",name:"Clench Release Power",description:"Explosive clench and release",category:"strength",subcategory:"fast",difficulty:"intermediate",duration:"3:30",reps:"15 reps",videoCode:"x9x5uzi",benefit:"Increases power.",solution:"Trains fast force output.",gender:"both",thumbnail:"S3"},
            { id:"S4",name:"Isometric Strength Hold",description:"Static high tension hold",category:"strength",subcategory:"slow",difficulty:"intermediate",duration:"4:00",reps:"5 × 15s",videoCode:"x9x5uzi",benefit:"Strengthens holding capacity.",solution:"Improves isometric strength.",gender:"both",thumbnail:"S4"},
            { id:"S5",name:"Resistance Focus Hold",description:"Strength against internal resistance",category:"strength",subcategory:"slow",difficulty:"advanced",duration:"4:30",reps:"6 reps",videoCode:"x9x5uzi",benefit:"Boosts resistance strength.",solution:"Increases load tolerance.",gender:"both",thumbnail:"S5"},
            { id:"S6",name:"Power Pulse Advanced",description:"Fast powerful pulses",category:"strength",subcategory:"fast",difficulty:"advanced",duration:"3:20",reps:"20 pulses",videoCode:"x9x5uzi",benefit:"Explosive pelvic power.",solution:"Fast-twitch activation.",gender:"both",thumbnail:"S6"},
            { id:"S7",name:"Endurance Strength Hold",description:"Long strong contractions",category:"strength",subcategory:"slow",difficulty:"advanced",duration:"5:00",reps:"5 × 20s",videoCode:"x9x5uzi",benefit:"Strength + endurance.",solution:"Delayed fatigue.",gender:"both",thumbnail:"S7"},
            { id:"S8",name:"Male Pelvic Power",description:"Male focused strength contractions",category:"strength",subcategory:"slow",difficulty:"advanced",duration:"4:40",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Male pelvic strength.",solution:"Targets male muscle load.",gender:"Male",thumbnail:"S8"},
            { id:"S9",name:"Female Core Strength",description:"Female pelvic strengthening",category:"strength",subcategory:"slow",difficulty:"advanced",duration:"4:50",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Female pelvic stability.",solution:"Supports core control.",gender:"Female",thumbnail:"S9"},
            { id:"S10",name:"Power Hold Ladder",description:"Increasing power holds",category:"strength",subcategory:"slow",difficulty:"intermediate",duration:"4:10",reps:"Ladder sets",videoCode:"x9x5uzi",benefit:"Progressive strength.",solution:"Step load increase.",gender:"both",thumbnail:"S10"}
        ],

        control: [
            { id:"C1",name:"Elevator Control",description:"Gradual increase and decrease of contraction",category:"control",subcategory:"slow",difficulty:"beginner",duration:"3:20",reps:"8 cycles",videoCode:"x9x5uzi",benefit:"Improves graded control.",solution:"Teaches intensity variation.",gender:"both",thumbnail:"C1"},
            { id:"C2",name:"Stop Start Hold",description:"Instant stop and release training",category:"control",subcategory:"fast",difficulty:"beginner",duration:"2:40",reps:"15 reps",videoCode:"x9x5uzi",benefit:"Quick control response.",solution:"Trains on-off control.",gender:"both",thumbnail:"C2"},
            { id:"C3",name:"Front Back Control",description:"Front to back muscle activation",category:"control",subcategory:"slow",difficulty:"intermediate",duration:"3:30",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Improves muscle isolation.",solution:"Selective activation.",gender:"both",thumbnail:"C3"},
            { id:"C4",name:"Wave Control Drill",description:"Smooth wave-like contractions",category:"control",subcategory:"slow",difficulty:"intermediate",duration:"3:45",reps:"8 waves",videoCode:"x9x5uzi",benefit:"Fluid control.",solution:"Coordination training.",gender:"both",thumbnail:"C4"},
            { id:"C5",name:"Pulse Control Hold",description:"Controlled pulse with hold",category:"control",subcategory:"fast",difficulty:"beginner",duration:"3:00",reps:"18 pulses",videoCode:"x9x5uzi",benefit:"Pulse accuracy.",solution:"Control precision.",gender:"both",thumbnail:"C5"},
            { id:"C6",name:"Segmented Control",description:"Segment by segment contraction",category:"control",subcategory:"slow",difficulty:"intermediate",duration:"3:50",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Segment awareness.",solution:"Improves separation.",gender:"both",thumbnail:"C6"},
            { id:"C7",name:"Rapid Control Switch",description:"Fast switch between contract and relax",category:"control",subcategory:"fast",difficulty:"intermediate",duration:"2:55",reps:"20 switches",videoCode:"x9x5uzi",benefit:"Reaction control.",solution:"Speed accuracy.",gender:"both",thumbnail:"C7"},
            { id:"C8",name:"Precision Hold Control",description:"Exact duration holds",category:"control",subcategory:"slow",difficulty:"beginner",duration:"3:10",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Timing accuracy.",solution:"Controlled holds.",gender:"both",thumbnail:"C8"},
            { id:"C9",name:"Control Ladder",description:"Increasing control difficulty ladder",category:"control",subcategory:"slow",difficulty:"intermediate",duration:"3:40",reps:"Ladder sets",videoCode:"x9x5uzi",benefit:"Progressive control.",solution:"Step control.",gender:"both",thumbnail:"C9"},
            { id:"C10",name:"Rhythm Control",description:"Maintain steady contraction rhythm",category:"control",subcategory:"fast",difficulty:"beginner",duration:"2:50",reps:"20 reps",videoCode:"x9x5uzi",benefit:"Rhythmic stability.",solution:"Consistency training.",gender:"both",thumbnail:"C10"}
        ],

        functional: [
            { id:"FU1",name:"Walking Kegels",description:"Kegel contractions while walking",category:"functional",subcategory:"activity",difficulty:"beginner",duration:"3:30",reps:"5 min walk",videoCode:"x9x5uzi",benefit:"Daily integration.",solution:"Builds habit.",gender:"both",thumbnail:"FU1"},
            { id:"FU2",name:"Standing Hold",description:"Kegels in standing posture",category:"functional",subcategory:"posture",difficulty:"beginner",duration:"3:10",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Postural control.",solution:"Improves balance.",gender:"both",thumbnail:"FU2"},
            { id:"FU3",name:"Sitting Control",description:"Pelvic engagement while sitting",category:"functional",subcategory:"posture",difficulty:"beginner",duration:"3:00",reps:"12 reps",videoCode:"x9x5uzi",benefit:"Desk friendly.",solution:"Office safe.",gender:"both",thumbnail:"FU3"},
            { id:"FU4",name:"Cough Guard",description:"Pre-contraction before cough",category:"functional",subcategory:"stress",difficulty:"beginner",duration:"2:45",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Leak prevention.",solution:"Stress control.",gender:"both",thumbnail:"FU4"},
            { id:"FU5",name:"Laugh Control",description:"Control during laughter",category:"functional",subcategory:"stress",difficulty:"beginner",duration:"3:05",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Social confidence.",solution:"Reflex training.",gender:"both",thumbnail:"FU5"},
            { id:"FU6",name:"Lift Support",description:"Pelvic support during lifting",category:"functional",subcategory:"stress",difficulty:"intermediate",duration:"3:40",reps:"6 reps",videoCode:"x9x5uzi",benefit:"Load protection.",solution:"Core safety.",gender:"both",thumbnail:"FU6"},
            { id:"FU7",name:"Stair Climb Kegels",description:"Kegels while climbing stairs",category:"functional",subcategory:"activity",difficulty:"intermediate",duration:"3:20",reps:"2 rounds",videoCode:"x9x5uzi",benefit:"Functional endurance.",solution:"Daily strength.",gender:"both",thumbnail:"FU7"},
            { id:"FU8",name:"Car Seat Control",description:"Kegels while driving",category:"functional",subcategory:"activity",difficulty:"beginner",duration:"3:10",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Time efficient.",solution:"Commute use.",gender:"both",thumbnail:"FU8"},
            { id:"FU9",name:"Standing Shift Hold",description:"Weight shift with hold",category:"functional",subcategory:"posture",difficulty:"intermediate",duration:"3:25",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Dynamic balance.",solution:"Stability gain.",gender:"both",thumbnail:"FU9"},
            { id:"FU10",name:"Desk Micro Holds",description:"Short holds at desk",category:"functional",subcategory:"posture",difficulty:"beginner",duration:"2:50",reps:"15 reps",videoCode:"x9x5uzi",benefit:"Discreet training.",solution:"Office routine.",gender:"both",thumbnail:"FU10"}
        ],

        breathing: [
            { id:"B1",name:"Diaphragmatic Sync",description:"Deep breathing with pelvic sync",category:"breathing",subcategory:"breath-sync",difficulty:"beginner",duration:"3:30",reps:"10 cycles",videoCode:"x9x5uzi",benefit:"Breath coordination.",solution:"Reduces strain.",gender:"both",thumbnail:"B1"},
            { id:"B2",name:"Inhale Relax Exhale Hold",description:"Relax on inhale, hold on exhale",category:"breathing",subcategory:"breath-sync",difficulty:"beginner",duration:"3:20",reps:"12 cycles",videoCode:"x9x5uzi",benefit:"Natural rhythm.",solution:"Improves control.",gender:"both",thumbnail:"B2"},
            { id:"B3",name:"Slow Breath Hold",description:"Slow breathing with gentle hold",category:"breathing",subcategory:"slow",difficulty:"beginner",duration:"3:45",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Calms nervous system.",solution:"Stress reduction.",gender:"both",thumbnail:"B3"},
            { id:"B4",name:"Pulse Breath Control",description:"Pulse contractions with breathing",category:"breathing",subcategory:"fast",difficulty:"beginner",duration:"3:00",reps:"15 pulses",videoCode:"x9x5uzi",benefit:"Breath timing.",solution:"Improves coordination.",gender:"both",thumbnail:"B4"},
            { id:"B5",name:"Box Breathing Kegels",description:"4-4-4-4 breath pattern",category:"breathing",subcategory:"pranayama",difficulty:"intermediate",duration:"4:00",reps:"8 cycles",videoCode:"x9x5uzi",benefit:"Mental focus.",solution:"Improves stability.",gender:"both",thumbnail:"B5"},
            { id:"B6",name:"Extended Exhale Hold",description:"Long exhale with contraction",category:"breathing",subcategory:"slow",difficulty:"intermediate",duration:"4:10",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Endurance control.",solution:"Improves stamina.",gender:"both",thumbnail:"B6"},
            { id:"B7",name:"Breath Awareness Hold",description:"Awareness-focused breathing holds",category:"breathing",subcategory:"slow",difficulty:"beginner",duration:"3:25",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Mind-body link.",solution:"Better technique.",gender:"both",thumbnail:"B7"},
            { id:"B8",name:"Rhythm Breath Pulses",description:"Rhythmic breathing pulses",category:"breathing",subcategory:"fast",difficulty:"beginner",duration:"2:50",reps:"20 pulses",videoCode:"x9x5uzi",benefit:"Rhythmic flow.",solution:"Timing accuracy.",gender:"both",thumbnail:"B8"},
            { id:"B9",name:"Deep Belly Sync",description:"Belly breathing coordination",category:"breathing",subcategory:"breath-sync",difficulty:"beginner",duration:"3:40",reps:"12 cycles",videoCode:"x9x5uzi",benefit:"Relaxation.",solution:"Reduces tension.",gender:"both",thumbnail:"B9"},
            { id:"B10",name:"Breath Ladder Hold",description:"Increasing breath-hold ladder",category:"breathing",subcategory:"slow",difficulty:"intermediate",duration:"4:20",reps:"Ladder sets",videoCode:"x9x5uzi",benefit:"Progressive control.",solution:"Builds endurance.",gender:"both",thumbnail:"B10"}
        ],

        sexual: [
            // Male exercises
            { id:"SPM1",name:"Erection Strength Hold",description:"Targeted holds for erection quality",category:"sexual",subcategory:"male",difficulty:"beginner",duration:"3:30",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Improves erection firmness.",solution:"Strengthens pelvic muscles.",gender:"Male",thumbnail:"SPM1"},
            { id:"SPM2",name:"Ejaculation Control Pulse",description:"Controlled pulses for timing",category:"sexual",subcategory:"male",difficulty:"intermediate",duration:"3:10",reps:"20 pulses",videoCode:"x9x5uzi",benefit:"Better timing control.",solution:"Refines reflex control.",gender:"Male",thumbnail:"SPM2"},
            { id:"SPM3",name:"Prostate Circulation Hold",description:"Holds to enhance circulation",category:"sexual",subcategory:"male",difficulty:"beginner",duration:"3:45",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Supports prostate health.",solution:"Improves blood flow.",gender:"Male",thumbnail:"SPM3"},
            { id:"SPM4",name:"Stamina Build Cycle",description:"Endurance cycles for performance",category:"sexual",subcategory:"male",difficulty:"intermediate",duration:"4:00",reps:"8 cycles",videoCode:"x9x5uzi",benefit:"Longer performance.",solution:"Builds endurance.",gender:"Male",thumbnail:"SPM4"},
            { id:"SPM5",name:"Power Squeeze Series",description:"Strong squeeze repetitions",category:"sexual",subcategory:"male",difficulty:"intermediate",duration:"3:20",reps:"12 reps",videoCode:"x9x5uzi",benefit:"Increases power.",solution:"Boosts contraction strength.",gender:"Male",thumbnail:"SPM5"},
            // Female exercises
            { id:"SPF1",name:"Tone & Tighten Hold",description:"Tone-focused holds",category:"sexual",subcategory:"female",difficulty:"beginner",duration:"3:30",reps:"12 reps",videoCode:"x9x5uzi",benefit:"Improves tone.",solution:"Strengthens muscles.",gender:"Female",thumbnail:"SPF1"},
            { id:"SPF2",name:"Sensation Pulse",description:"Gentle pulses for sensation",category:"sexual",subcategory:"female",difficulty:"beginner",duration:"2:50",reps:"20 pulses",videoCode:"x9x5uzi",benefit:"Enhanced sensation.",solution:"Improves awareness.",gender:"Female",thumbnail:"SPF2"},
            { id:"SPF3",name:"Orgasm Control Cycle",description:"Control cycles for intensity",category:"sexual",subcategory:"female",difficulty:"intermediate",duration:"4:00",reps:"8 cycles",videoCode:"x9x5uzi",benefit:"Stronger orgasms.",solution:"Control training.",gender:"Female",thumbnail:"SPF3"},
            { id:"SPF4",name:"Arousal Endurance",description:"Endurance holds for arousal",category:"sexual",subcategory:"female",difficulty:"intermediate",duration:"4:10",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Sustained arousal.",solution:"Builds stamina.",gender:"Female",thumbnail:"SPF4"},
            { id:"SPF5",name:"Confidence Builder",description:"Gentle confidence drills",category:"sexual",subcategory:"female",difficulty:"beginner",duration:"3:15",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Body confidence.",solution:"Mind-body link.",gender:"Female",thumbnail:"SPF5"}
        ],

        rehab: [
            { id:"R1",name:"Gentle Activation Start",description:"Very light pelvic activation",category:"rehab",subcategory:"post-surgery",difficulty:"beginner",duration:"3:00",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Safe recovery start.",solution:"Protects healing tissues.",gender:"both",thumbnail:"R1"},
            { id:"R2",name:"Post Delivery Ease",description:"Gentle post-delivery holds",category:"rehab",subcategory:"postpartum",difficulty:"beginner",duration:"3:20",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Supports healing.",solution:"Gradual rebuilding.",gender:"Female",thumbnail:"R2"},
            { id:"R3",name:"Post Prostate Support",description:"Early recovery control holds",category:"rehab",subcategory:"post-surgery",difficulty:"beginner",duration:"3:30",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Regains control.",solution:"Restores function.",gender:"Male",thumbnail:"R3"},
            { id:"R4",name:"Urge Suppression Hold",description:"Hold to suppress urinary urge",category:"rehab",subcategory:"incontinence",difficulty:"beginner",duration:"3:15",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Reduces urgency.",solution:"Bladder control.",gender:"both",thumbnail:"R4"},
            { id:"R5",name:"Stress Leak Guard",description:"Control during pressure events",category:"rehab",subcategory:"incontinence",difficulty:"beginner",duration:"3:00",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Leak prevention.",solution:"Stress response training.",gender:"both",thumbnail:"R5"},
            { id:"R6",name:"Pelvic Relax Recovery",description:"Relaxation-focused rehab",category:"rehab",subcategory:"pain-relief",difficulty:"beginner",duration:"3:40",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Pain reduction.",solution:"Muscle relaxation.",gender:"both",thumbnail:"R6"},
            { id:"R7",name:"Gentle Pulse Rehab",description:"Soft pulses for circulation",category:"rehab",subcategory:"circulation",difficulty:"beginner",duration:"2:50",reps:"15 pulses",videoCode:"x9x5uzi",benefit:"Improves blood flow.",solution:"Promotes healing.",gender:"both",thumbnail:"R7"},
            { id:"R8",name:"Controlled Recovery Hold",description:"Controlled holds during rehab",category:"rehab",subcategory:"post-surgery",difficulty:"intermediate",duration:"3:45",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Steady recovery.",solution:"Safe strengthening.",gender:"both",thumbnail:"R8"},
            { id:"R9",name:"Pelvic Injury Support",description:"Supportive rehab contractions",category:"rehab",subcategory:"injury",difficulty:"beginner",duration:"3:30",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Injury healing.",solution:"Protective activation.",gender:"both",thumbnail:"R9"},
            { id:"R10",name:"Pain Ease Hold",description:"Hold to ease pelvic pain",category:"rehab",subcategory:"pain-relief",difficulty:"beginner",duration:"3:20",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Pain comfort.",solution:"Reduces tension.",gender:"both",thumbnail:"R10"}
        ],

        mindfulness: [
            { id:"M1",name:"Body Awareness Hold",description:"Mindful awareness during gentle holds",category:"mindfulness",subcategory:"awareness",difficulty:"beginner",duration:"3:30",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Improves awareness.",solution:"Mind-muscle link.",gender:"both",thumbnail:"M1"},
            { id:"M2",name:"Breath Focus Hold",description:"Focus on breath with contraction",category:"mindfulness",subcategory:"breath-focus",difficulty:"beginner",duration:"3:20",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Calms mind.",solution:"Breath anchoring.",gender:"both",thumbnail:"M2"},
            { id:"M3",name:"Slow Scan Contraction",description:"Body scan with slow holds",category:"mindfulness",subcategory:"awareness",difficulty:"beginner",duration:"3:45",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Enhanced perception.",solution:"Scan technique.",gender:"both",thumbnail:"M3"},
            { id:"M4",name:"Rhythm Awareness Pulse",description:"Mindful rhythmic pulses",category:"mindfulness",subcategory:"rhythm",difficulty:"beginner",duration:"3:00",reps:"18 pulses",videoCode:"x9x5uzi",benefit:"Rhythm control.",solution:"Attention training.",gender:"both",thumbnail:"M4"},
            { id:"M5",name:"Present Moment Hold",description:"Hold with present-moment focus",category:"mindfulness",subcategory:"presence",difficulty:"beginner",duration:"3:10",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Focus stability.",solution:"Present awareness.",gender:"both",thumbnail:"M5"},
            { id:"M6",name:"Gentle Awareness Flow",description:"Gentle flow with awareness",category:"mindfulness",subcategory:"flow",difficulty:"beginner",duration:"3:25",reps:"8 cycles",videoCode:"x9x5uzi",benefit:"Mind-body harmony.",solution:"Flow awareness.",gender:"both",thumbnail:"M6"},
            { id:"M7",name:"Counting Breath Holds",description:"Counted breaths during holds",category:"mindfulness",subcategory:"breath-focus",difficulty:"intermediate",duration:"3:40",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Mental clarity.",solution:"Counting anchor.",gender:"both",thumbnail:"M7"},
            { id:"M8",name:"Soft Attention Pulses",description:"Soft pulses with attention",category:"mindfulness",subcategory:"rhythm",difficulty:"beginner",duration:"2:50",reps:"20 pulses",videoCode:"x9x5uzi",benefit:"Gentle focus.",solution:"Low stress.",gender:"both",thumbnail:"M8"},
            { id:"M9",name:"Awareness Ladder",description:"Increasing awareness ladder",category:"mindfulness",subcategory:"awareness",difficulty:"intermediate",duration:"4:10",reps:"Ladder sets",videoCode:"x9x5uzi",benefit:"Progressive focus.",solution:"Step attention.",gender:"both",thumbnail:"M9"},
            { id:"M10",name:"Mindful Timing Hold",description:"Exact timing with awareness",category:"mindfulness",subcategory:"presence",difficulty:"intermediate",duration:"3:55",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Timing awareness.",solution:"Precision focus.",gender:"both",thumbnail:"M10"}
        ],

        hybrid: [
            { id:"H1",name:"Kegel + Bridge Basic",description:"Pelvic contraction with glute bridge",category:"hybrid",subcategory:"core",difficulty:"beginner",duration:"3:30",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Pelvic-glute coordination.",solution:"Builds base integration.",gender:"both",thumbnail:"H1"},
            { id:"H2",name:"Kegel + Squat Intro",description:"Pelvic engagement during squat",category:"hybrid",subcategory:"functional",difficulty:"beginner",duration:"3:40",reps:"10 reps",videoCode:"x9x5uzi",benefit:"Functional strength.",solution:"Daily movement control.",gender:"both",thumbnail:"H2"},
            { id:"H3",name:"Kegel + Plank Hold",description:"Plank with pelvic hold",category:"hybrid",subcategory:"core",difficulty:"intermediate",duration:"3:20",reps:"6 × 20s",videoCode:"x9x5uzi",benefit:"Core-pelvic stability.",solution:"Deep core activation.",gender:"both",thumbnail:"H3"},
            { id:"H4",name:"Kegel + Marching",description:"Pelvic control while marching",category:"hybrid",subcategory:"balance",difficulty:"beginner",duration:"3:00",reps:"20 steps",videoCode:"x9x5uzi",benefit:"Balance & control.",solution:"Dynamic coordination.",gender:"both",thumbnail:"H4"},
            { id:"H5",name:"Bridge Pulse Combo",description:"Bridge with pelvic pulses",category:"hybrid",subcategory:"core",difficulty:"intermediate",duration:"3:10",reps:"15 pulses",videoCode:"x9x5uzi",benefit:"Endurance + strength.",solution:"Pulse integration.",gender:"both",thumbnail:"H5"},
            { id:"H6",name:"Squat Hold Integration",description:"Squat hold with pelvic contraction",category:"hybrid",subcategory:"functional",difficulty:"intermediate",duration:"3:45",reps:"8 reps",videoCode:"x9x5uzi",benefit:"Lower-body control.",solution:"Load management.",gender:"both",thumbnail:"H6"},
            { id:"H7",name:"Plank Pulse Control",description:"Pelvic pulses in plank",category:"hybrid",subcategory:"core",difficulty:"advanced",duration:"3:00",reps:"20 pulses",videoCode:"x9x5uzi",benefit:"Advanced core strength.",solution:"High control demand.",gender:"both",thumbnail:"H7"},
            { id:"H8",name:"Standing Balance Hold",description:"Single-leg balance with hold",category:"hybrid",subcategory:"balance",difficulty:"intermediate",duration:"3:30",reps:"6 reps/leg",videoCode:"x9x5uzi",benefit:"Stability improvement.",solution:"Neuromuscular control.",gender:"both",thumbnail:"H8"},
            { id:"H9",name:"Dynamic Step Control",description:"Step movement with pelvic engagement",category:"hybrid",subcategory:"functional",difficulty:"beginner",duration:"3:20",reps:"20 steps",videoCode:"x9x5uzi",benefit:"Movement control.",solution:"Daily life use.",gender:"both",thumbnail:"H9"},
            { id:"H10",name:"Core Flow Combo",description:"Flowing core-pelvic movements",category:"hybrid",subcategory:"flow",difficulty:"intermediate",duration:"3:50",reps:"8 cycles",videoCode:"x9x5uzi",benefit:"Smooth coordination.",solution:"Fluid strength.",gender:"both",thumbnail:"H10"}
        ]
    };

    // Thumbnail images
    const thumbnailImages = {
        "F1": "https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "F2": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "F3": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "F4": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "F5": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "F6": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "F7": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "F8": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "F9": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "F10": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "S1": "https://images.unsplash.com/photo-1534367507877-0edd93bd013b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "S2": "https://images.unsplash.com/photo-1534367507877-0edd93bd013b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "S3": "https://images.unsplash.com/photo-1534367507877-0edd93bd013b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "S4": "https://images.unsplash.com/photo-1534367507877-0edd93bd013b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "S5": "https://images.unsplash.com/photo-1534367507877-0edd93bd013b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "S6": "https://images.unsplash.com/photo-1534367507877-0edd93bd013b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "S7": "https://images.unsplash.com/photo-1534367507877-0edd93bd013b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "S8": "https://images.unsplash.com/photo-1534367507877-0edd93bd013b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "S9": "https://images.unsplash.com/photo-1534367507877-0edd93bd013b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "S10": "https://images.unsplash.com/photo-1534367507877-0edd93bd013b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "C1": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "C2": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "C3": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "C4": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "C5": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "C6": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "C7": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "C8": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "C9": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "C10": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "FU1": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "FU2": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "FU3": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "FU4": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "FU5": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "FU6": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "FU7": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "FU8": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "FU9": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "FU10": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "B1": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "B2": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "B3": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "B4": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "B5": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "B6": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "B7": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "B8": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "B9": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "B10": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "SPM1": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "SPM2": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "SPM3": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "SPM4": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "SPM5": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "SPF1": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "SPF2": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "SPF3": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "SPF4": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "SPF5": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "R1": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "R2": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "R3": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "R4": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "R5": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "R6": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "R7": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "R8": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "R9": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "R10": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "M1": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "M2": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "M3": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "M4": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "M5": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "M6": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "M7": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "M8": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "M9": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "M10": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "H1": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "H2": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "H3": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "H4": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "H5": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "H6": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "H7": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "H8": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "H9": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
        "H10": "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80"
    };

    // Rest of the code remains the same (questions array, problem detection functions, etc.)
    // ==================== COMPLETE 65 QUESTIONS ====================
    const questions = [
        // Section 1: Demographic (5 questions)
        {
            id: 1,
            text: "What is your biological gender?",
            options: ["Male", "Female"],
            category: "demographic",
            scoreMap: { "Male": 0, "Female": 0 }
        },
        {
            id: 2,
            text: "What is your current age?",
            options: ["Under 25", "25-34", "35-44", "45-54", "55-64", "65+"],
            category: "demographic",
            scoreMap: { "Under 25": 0, "25-34": 5, "35-44": 10, "45-54": 15, "55-64": 20, "65+": 25 }
        },
        {
            id: 3,
            text: "Have you been pregnant? (Females only)",
            options: ["Never", "1 pregnancy", "2 pregnancies", "3+ pregnancies", "Currently pregnant"],
            category: "demographic",
            scoreMap: { "Never": 0, "1 pregnancy": 10, "2 pregnancies": 15, "3+ pregnancies": 20, "Currently pregnant": 25 },
            skipIfGender: "Male"
        },
        {
            id: 4,
            text: "Have you had any pelvic surgeries?",
            options: ["None", "C-section", "Hysterectomy", "Prostate surgery", "Other pelvic surgery"],
            category: "demographic",
            scoreMap: { "None": 0, "C-section": 15, "Hysterectomy": 20, "Prostate surgery": 25, "Other pelvic surgery": 15 }
        },
        {
            id: 5,
            text: "Any chronic health conditions?",
            options: ["None", "Diabetes", "Hypertension", "Back problems", "Multiple conditions"],
            category: "demographic",
            scoreMap: { "None": 0, "Diabetes": 10, "Hypertension": 10, "Back problems": 15, "Multiple conditions": 25 }
        },

        // Section 2: Symptoms & Problems (10 questions)
        {
            id: 6,
            text: "Do you experience urine leakage?",
            options: ["Never", "Rarely (few times/year)", "Sometimes (monthly)", "Often (weekly)", "Daily"],
            category: "symptoms",
            scoreMap: { "Never": 0, "Rarely (few times/year)": 10, "Sometimes (monthly)": 20, "Often (weekly)": 30, "Daily": 40 }
        },
        {
            id: 7,
            text: "When does leakage usually occur?",
            options: ["No leakage", "When coughing/sneezing", "During exercise", "With urgency", "All the time"],
            category: "symptoms",
            scoreMap: { "No leakage": 0, "When coughing/sneezing": 15, "During exercise": 20, "With urgency": 25, "All the time": 35 }
        },
        {
            id: 8,
            text: "How many times do you urinate at night?",
            options: ["0 times", "1 time", "2 times", "3 times", "4+ times"],
            category: "symptoms",
            scoreMap: { "0 times": 0, "1 time": 5, "2 times": 10, "3 times": 20, "4+ times": 30 }
        },
        {
            id: 9,
            text: "Do you have sudden strong urges to urinate?",
            options: ["Never", "Rarely", "Sometimes", "Often", "Constantly"],
            category: "symptoms",
            scoreMap: { "Never": 0, "Rarely": 10, "Sometimes": 20, "Often": 30, "Constantly": 40 }
        },
        {
            id: 10,
            text: "Difficulty starting urine flow?",
            options: ["Never", "Occasionally", "Sometimes", "Often", "Always"],
            category: "symptoms",
            scoreMap: { "Never": 0, "Occasionally": 5, "Sometimes": 15, "Often": 25, "Always": 35 }
        },
        {
            id: 11,
            text: "Feeling of incomplete emptying?",
            options: ["Never", "Rarely", "Sometimes", "Often", "Always"],
            category: "symptoms",
            scoreMap: { "Never": 0, "Rarely": 5, "Sometimes": 15, "Often": 25, "Always": 35 }
        },
        {
            id: 12,
            text: "Any pelvic pain or discomfort?",
            options: ["None", "During/after sex", "When sitting", "Lower back pain", "Constant pain"],
            category: "symptoms",
            scoreMap: { "None": 0, "During/after sex": 15, "When sitting": 20, "Lower back pain": 25, "Constant pain": 35 }
        },
        {
            id: 13,
            text: "Pain during sexual intercourse?",
            options: ["Never", "Occasionally", "Sometimes", "Often", "Always painful"],
            category: "symptoms",
            scoreMap: { "Never": 0, "Occasionally": 10, "Sometimes": 20, "Often": 30, "Always painful": 40 }
        },
        {
            id: 14,
            text: "Do you experience constipation?",
            options: ["Never", "Occasionally", "Sometimes", "Often", "Chronic"],
            category: "symptoms",
            scoreMap: { "Never": 0, "Occasionally": 5, "Sometimes": 10, "Often": 20, "Chronic": 30 }
        },
        {
            id: 15,
            text: "Do you strain during bowel movements?",
            options: ["Never", "Occasionally", "Sometimes", "Often", "Always"],
            category: "symptoms",
            scoreMap: { "Never": 0, "Occasionally": 5, "Sometimes": 10, "Often": 20, "Always": 30 }
        },

        // Section 3: Lifestyle & Habits (10 questions)
        {
            id: 16,
            text: "What is your occupation?",
            options: ["Sedentary (desk job)", "Standing job", "Light physical", "Heavy physical", "Athlete"],
            category: "lifestyle",
            scoreMap: { "Sedentary (desk job)": 15, "Standing job": 10, "Light physical": 5, "Heavy physical": 20, "Athlete": 25 }
        },
        {
            id: 17,
            text: "Hours sitting per day?",
            options: ["< 4 hours", "4-8 hours", "8-10 hours", "10-12 hours", "> 12 hours"],
            category: "lifestyle",
            scoreMap: { "< 4 hours": 0, "4-8 hours": 10, "8-10 hours": 15, "10-12 hours": 20, "> 12 hours": 25 }
        },
        {
            id: 18,
            text: "Regular exercise routine?",
            options: ["None", "1-2 times/week", "3-4 times/week", "5+ times/week", "Athlete training"],
            category: "lifestyle",
            scoreMap: { "None": 20, "1-2 times/week": 10, "3-4 times/week": 5, "5+ times/week": 0, "Athlete training": 0 }
        },
        {
            id: 19,
            text: "Type of exercise you do?",
            options: ["None", "Walking", "Running", "Weight training", "High impact sports"],
            category: "lifestyle",
            scoreMap: { "None": 20, "Walking": 5, "Running": 15, "Weight training": 20, "High impact sports": 25 }
        },
        {
            id: 20,
            text: "Daily water intake?",
            options: ["< 1 liter", "1-2 liters", "2-3 liters", "3-4 liters", "> 4 liters"],
            category: "lifestyle",
            scoreMap: { "< 1 liter": 20, "1-2 liters": 10, "2-3 liters": 0, "3-4 liters": 0, "> 4 liters": 0 }
        },
        {
            id: 21,
            text: "Caffeine consumption?",
            options: ["None", "1 cup/day", "2-3 cups/day", "4-5 cups/day", "> 5 cups/day"],
            category: "lifestyle",
            scoreMap: { "None": 0, "1 cup/day": 5, "2-3 cups/day": 10, "4-5 cups/day": 20, "> 5 cups/day": 25 }
        },
        {
            id: 22,
            text: "Alcohol consumption?",
            options: ["None", "Occasionally", "Weekly", "Several times/week", "Daily"],
            category: "lifestyle",
            scoreMap: { "None": 0, "Occasionally": 5, "Weekly": 10, "Several times/week": 20, "Daily": 30 }
        },
        {
            id: 23,
            text: "Smoking or vaping?",
            options: ["Never", "Former smoker", "Occasionally", "Regular smoker", "Heavy smoker"],
            category: "lifestyle",
            scoreMap: { "Never": 0, "Former smoker": 10, "Occasionally": 15, "Regular smoker": 25, "Heavy smoker": 35 }
        },
        {
            id: 24,
            text: "Quality of sleep?",
            options: ["Excellent", "Good", "Fair", "Poor", "Very poor"],
            category: "lifestyle",
            scoreMap: { "Excellent": 0, "Good": 5, "Fair": 10, "Poor": 20, "Very poor": 30 }
        },
        {
            id: 25,
            text: "Stress level in daily life?",
            options: ["Very low", "Low", "Moderate", "High", "Very high"],
            category: "lifestyle",
            scoreMap: { "Very low": 0, "Low": 5, "Moderate": 10, "High": 20, "Very high": 30 }
        },

        // Section 4: Sexual Health (8 questions)
        {
            id: 26,
            text: "Satisfaction with sexual function?",
            options: ["Very satisfied", "Satisfied", "Neutral", "Dissatisfied", "Very dissatisfied"],
            category: "sexual",
            scoreMap: { "Very satisfied": 0, "Satisfied": 5, "Neutral": 10, "Dissatisfied": 20, "Very dissatisfied": 30 }
        },
        {
            id: 27,
            text: "Erection quality (Males)?",
            options: ["Excellent", "Good", "Fair", "Poor", "No erection"],
            category: "sexual",
            scoreMap: { "Excellent": 0, "Good": 5, "Fair": 15, "Poor": 25, "No erection": 35 },
            skipIfGender: "Female"
        },
        {
            id: 28,
            text: "Vaginal dryness (Females)?",
            options: ["Never", "Occasionally", "Sometimes", "Often", "Always"],
            category: "sexual",
            scoreMap: { "Never": 0, "Occasionally": 5, "Sometimes": 15, "Often": 25, "Always": 35 },
            skipIfGender: "Male"
        },
        {
            id: 29,
            text: "Orgasm frequency?",
            options: ["Always", "Usually", "Sometimes", "Rarely", "Never"],
            category: "sexual",
            scoreMap: { "Always": 0, "Usually": 5, "Sometimes": 15, "Rarely": 25, "Never": 35 }
        },
        {
            id: 30,
            text: "Orgasm intensity?",
            options: ["Very intense", "Intense", "Moderate", "Mild", "No orgasm"],
            category: "sexual",
            scoreMap: { "Very intense": 0, "Intense": 5, "Moderate": 15, "Mild": 25, "No orgasm": 35 }
        },
        {
            id: 31,
            text: "Sexual desire/libido?",
            options: ["Very high", "High", "Moderate", "Low", "Very low"],
            category: "sexual",
            scoreMap: { "Very high": 0, "High": 5, "Moderate": 10, "Low": 20, "Very low": 30 }
        },
        {
            id: 32,
            text: "Pain after intercourse?",
            options: ["Never", "Rarely", "Sometimes", "Often", "Always"],
            category: "sexual",
            scoreMap: { "Never": 0, "Rarely": 5, "Sometimes": 15, "Often": 25, "Always": 35 }
        },
        {
            id: 33,
            text: "Confidence in sexual performance?",
            options: ["Very confident", "Confident", "Neutral", "Insecure", "Very insecure"],
            category: "sexual",
            scoreMap: { "Very confident": 0, "Confident": 5, "Neutral": 10, "Insecure": 20, "Very insecure": 30 }
        },

        // Section 5: Previous Experience & Goals (7 questions)
        {
            id: 34,
            text: "Previous pelvic floor exercise experience?",
            options: ["None", "Tried few times", "Occasional practice", "Regular practice", "Expert"],
            category: "experience",
            scoreMap: { "None": 20, "Tried few times": 10, "Occasional practice": 5, "Regular practice": 0, "Expert": 0 }
        },
        {
            id: 35,
            text: "Awareness of pelvic floor muscles?",
            options: ["No idea", "Vague idea", "Some awareness", "Good awareness", "Excellent awareness"],
            category: "experience",
            scoreMap: { "No idea": 20, "Vague idea": 10, "Some awareness": 5, "Good awareness": 0, "Excellent awareness": 0 }
        },
        {
            id: 36,
            text: "Primary goal for this program?",
            options: ["Stop leakage", "Improve sexual function", "Reduce pain", "General health", "All of above"],
            category: "goals",
            scoreMap: { "Stop leakage": 20, "Improve sexual function": 20, "Reduce pain": 20, "General health": 10, "All of above": 25 }
        },
        {
            id: 37,
            text: "Secondary goals?",
            options: ["Better bladder control", "Improved intimacy", "Pain relief", "Postpartum recovery", "Sports performance"],
            category: "goals",
            scoreMap: { "Better bladder control": 15, "Improved intimacy": 15, "Pain relief": 15, "Postpartum recovery": 20, "Sports performance": 10 }
        },
        {
            id: 38,
            text: "Time available daily for exercises?",
            options: ["5-10 minutes", "10-15 minutes", "15-20 minutes", "20-30 minutes", "30+ minutes"],
            category: "goals",
            scoreMap: { "5-10 minutes": 10, "10-15 minutes": 5, "15-20 minutes": 0, "20-30 minutes": 0, "30+ minutes": 0 }
        },
        {
            id: 39,
            text: "Willingness to commit to 30 days?",
            options: ["100% committed", "Very willing", "Moderately willing", "Somewhat willing", "Not sure"],
            category: "goals",
            scoreMap: { "100% committed": 0, "Very willing": 5, "Moderately willing": 10, "Somewhat willing": 20, "Not sure": 30 }
        },
        {
            id: 40,
            text: "Motivation level?",
            options: ["Extremely motivated", "Very motivated", "Moderately motivated", "Slightly motivated", "Not motivated"],
            category: "goals",
            scoreMap: { "Extremely motivated": 0, "Very motivated": 5, "Moderately motivated": 10, "Slightly motivated": 20, "Not motivated": 30 }
        },

        // Section 6: Medical & Specific Concerns (10 questions)
        {
            id: 41,
            text: "History of urinary tract infections?",
            options: ["Never", "1-2 times", "3-5 times", "6-10 times", "Frequent"],
            category: "medical",
            scoreMap: { "Never": 0, "1-2 times": 5, "3-5 times": 10, "6-10 times": 20, "Frequent": 30 }
        },
        {
            id: 42,
            text: "History of kidney stones?",
            options: ["Never", "Once", "2-3 times", "4+ times", "Chronic"],
            category: "medical",
            scoreMap: { "Never": 0, "Once": 5, "2-3 times": 10, "4+ times": 20, "Chronic": 30 }
        },
        {
            id: 43,
            text: "Prostate issues (Males)?",
            options: ["None", "Mild enlargement", "Moderate enlargement", "Severe enlargement", "Cancer history"],
            category: "medical",
            scoreMap: { "None": 0, "Mild enlargement": 10, "Moderate enlargement": 20, "Severe enlargement": 30, "Cancer history": 40 },
            skipIfGender: "Female"
        },
        {
            id: 44,
            text: "Menstrual issues (Females)?",
            options: ["None", "Mild cramps", "Moderate pain", "Severe pain", "Endometriosis"],
            category: "medical",
            scoreMap: { "None": 0, "Mild cramps": 5, "Moderate pain": 15, "Severe pain": 25, "Endometriosis": 35 },
            skipIfGender: "Male"
        },
        {
            id: 45,
            text: "History of prolapse?",
            options: ["None", "Mild", "Moderate", "Severe", "Surgery for prolapse"],
            category: "medical",
            scoreMap: { "None": 0, "Mild": 10, "Moderate": 20, "Severe": 30, "Surgery for prolapse": 40 }
        },
        {
            id: 46,
            text: "Medications affecting urination?",
            options: ["None", "Diuretics", "Blood pressure meds", "Antidepressants", "Multiple medications"],
            category: "medical",
            scoreMap: { "None": 0, "Diuretics": 10, "Blood pressure meds": 15, "Antidepressants": 20, "Multiple medications": 30 }
        },
        {
            id: 47,
            text: "Allergies affecting pelvic area?",
            options: ["None", "Mild", "Moderate", "Severe", "Multiple allergies"],
            category: "medical",
            scoreMap: { "None": 0, "Mild": 5, "Moderate": 15, "Severe": 25, "Multiple allergies": 35 }
        },
        {
            id: 48,
            text: "Recent weight changes?",
            options: ["Stable", "Gained 5-10 lbs", "Gained 10+ lbs", "Lost 5-10 lbs", "Lost 10+ lbs"],
            category: "medical",
            scoreMap: { "Stable": 0, "Gained 5-10 lbs": 10, "Gained 10+ lbs": 20, "Lost 5-10 lbs": 5, "Lost 10+ lbs": 10 }
        },
        {
            id: 49,
            text: "Family history of pelvic issues?",
            options: ["None", "Mother", "Sister", "Multiple relatives", "Strong family history"],
            category: "medical",
            scoreMap: { "None": 0, "Mother": 10, "Sister": 15, "Multiple relatives": 20, "Strong family history": 25 }
        },
        {
            id: 50,
            text: "Previous physical therapy?",
            options: ["Never", "Few sessions", "Completed program", "Multiple programs", "Currently in therapy"],
            category: "medical",
            scoreMap: { "Never": 0, "Few sessions": 5, "Completed program": 10, "Multiple programs": 20, "Currently in therapy": 30 }
        },

        // NEW SECTION: Sexual Health Supplement (15 questions)
        {
            id: 51,
            text: "Do you consume substances harmful for sexual health? (Tobacco, alcohol, drugs)",
            options: ["Never", "Rarely", "Sometimes", "Often", "Regularly"],
            category: "sexual",
            scoreMap: { "Never": 0, "Rarely": 10, "Sometimes": 20, "Often": 30, "Regularly": 40 },
            skipIfGender: "Female"
        },
        {
            id: 52,
            text: "How long have you been consuming these substances?",
            options: ["Never consumed", "Less than 1 year", "1-3 years", "3-5 years", "More than 5 years"],
            category: "sexual",
            scoreMap: { "Never consumed": 0, "Less than 1 year": 5, "1-3 years": 15, "3-5 years": 25, "More than 5 years": 35 },
            skipIfGender: "Female"
        },
        {
            id: 53,
            text: "How frequently do you consume these substances now?",
            options: ["Not currently", "Once a month", "Once a week", "Several times/week", "Daily"],
            category: "sexual",
            scoreMap: { "Not currently": 0, "Once a month": 5, "Once a week": 15, "Several times/week": 25, "Daily": 35 },
            skipIfGender: "Female"
        },
        {
            id: 54,
            text: "Do you take any performance enhancing drugs?",
            options: ["Never", "Occasionally", "Sometimes", "Often", "Regularly"],
            category: "sexual",
            scoreMap: { "Never": 0, "Occasionally": 10, "Sometimes": 20, "Often": 30, "Regularly": 40 },
            skipIfGender: "Female"
        },
        {
            id: 55,
            text: "Have you experienced side effects from these substances?",
            options: ["No", "Mild effects", "Moderate effects", "Severe effects", "Significant problems"],
            category: "sexual",
            scoreMap: { "No": 0, "Mild effects": 10, "Moderate effects": 20, "Severe effects": 30, "Significant problems": 40 },
            skipIfGender: "Female"
        },

        // 2. Masturbation habits (Both Genders - 5 questions)
        {
            id: 56,
            text: "When did you start masturbating?",
            options: ["Never masturbate", "After 18 years", "13-17 years", "Before 13 years", "Not sure"],
            category: "sexual",
            scoreMap: { "Never masturbate": 0, "After 18 years": 5, "13-17 years": 10, "Before 13 years": 15, "Not sure": 5 }
        },
        {
            id: 57,
            text: "How long have you been masturbating continuously?",
            options: ["Never", "Less than 1 year", "1-3 years", "3-5 years", "More than 5 years"],
            category: "sexual",
            scoreMap: { "Never": 0, "Less than 1 year": 5, "1-3 years": 10, "3-5 years": 15, "More than 5 years": 20 }
        },
        {
            id: 58,
            text: "Do you currently masturbate?",
            options: ["Never", "Rarely", "Sometimes", "Often", "Daily"],
            category: "sexual",
            scoreMap: { "Never": 0, "Rarely": 5, "Sometimes": 10, "Often": 15, "Daily": 20 }
        },
        {
            id: 59,
            text: "How frequently do you masturbate?",
            options: ["Never", "1-2 times/month", "1-2 times/week", "3-4 times/week", "Daily or more"],
            category: "sexual",
            scoreMap: { "Never": 0, "1-2 times/month": 5, "1-2 times/week": 10, "3-4 times/week": 15, "Daily or more": 20 }
        },
        {
            id: 60,
            text: "Do you feel masturbation affects your sexual performance?",
            options: ["No effect", "Slight effect", "Moderate effect", "Significant effect", "Major problem"],
            category: "sexual",
            scoreMap: { "No effect": 0, "Slight effect": 10, "Moderate effect": 20, "Significant effect": 30, "Major problem": 40 }
        },

        // 3. Sexual activity and protection (Both Genders - 5 questions)
        {
            id: 61,
            text: "Are you sexually active?",
            options: ["Never", "Rarely", "Sometimes", "Often", "Very active"],
            category: "sexual",
            scoreMap: { "Never": 0, "Rarely": 5, "Sometimes": 10, "Often": 15, "Very active": 20 }
        },
        {
            id: 62,
            text: "What is your approximate number of sexual partners?",
            options: ["0", "1-2", "3-5", "6-10", "10+"],
            category: "sexual",
            scoreMap: { "0": 0, "1-2": 5, "3-5": 10, "6-10": 15, "10+": 20 }
        },
        {
            id: 63,
            text: "Do you use protection during sexual activity?",
            options: ["Always", "Usually", "Sometimes", "Rarely", "Never"],
            category: "sexual",
            scoreMap: { "Always": 0, "Usually": 5, "Sometimes": 15, "Rarely": 25, "Never": 35 }
        },
        {
            id: 64,
            text: "Have you experienced any sexually transmitted infections?",
            options: ["Never", "Once", "2-3 times", "Multiple times", "Chronic issue"],
            category: "sexual",
            scoreMap: { "Never": 0, "Once": 10, "2-3 times": 20, "Multiple times": 30, "Chronic issue": 40 }
        },
        {
            id: 65,
            text: "Do you regularly get tested for sexual health?",
            options: ["Regularly", "Occasionally", "Rarely", "Only when symptomatic", "Never"],
            category: "sexual",
            scoreMap: { "Regularly": 0, "Occasionally": 5, "Rarely": 10, "Only when symptomatic": 20, "Never": 30 }
        }
    ];

    // ==================== PROBLEM DETECTION FUNCTIONS ====================
    function detectProblems() {
        const problems = [];
        
        // Check for urinary leakage problems (Questions 6-11)
        const leakageAnswers = [
            appState.userAnswers[6], appState.userAnswers[7], appState.userAnswers[8],
            appState.userAnswers[9], appState.userAnswers[10], appState.userAnswers[11]
        ];
        
        const hasLeakage = leakageAnswers.some(answer => 
            answer && (answer.includes("Often") || answer.includes("Daily") || 
                      answer.includes("Constantly") || answer.includes("Always") ||
                      answer.includes("With urgency") || answer.includes("All the time"))
        );
        
        if (hasLeakage) {
            problems.push("Urinary Incontinence");
        } else if (leakageAnswers.some(answer => answer && (answer.includes("Sometimes") || answer.includes("Rarely")))) {
            problems.push("Mild Bladder Control Issues");
        }
        
        // Check for pain issues (Questions 12-13, 32)
        const painAnswers = [
            appState.userAnswers[12], appState.userAnswers[13], appState.userAnswers[32]
        ];
        
        const hasPain = painAnswers.some(answer => 
            answer && (answer.includes("pain") || answer.includes("Pain") || 
                      answer.includes("Often") || answer.includes("Always") ||
                      answer.includes("Constant"))
        );
        
        if (hasPain) {
            problems.push("Pelvic Pain/Discomfort");
        }
        
        // Check for sexual function issues (Questions 26-33, plus sexual supplement)
        const sexualAnswers = [
            appState.userAnswers[26], appState.userAnswers[29], appState.userAnswers[30],
            appState.userAnswers[31], appState.userAnswers[33]
        ];
        
        const hasSexualIssues = sexualAnswers.some(answer => 
            answer && (answer.includes("Dissatisfied") || answer.includes("Poor") || 
                      answer.includes("Low") || answer.includes("Insecure") ||
                      answer.includes("Never") || answer.includes("Rarely"))
        );
        
        if (hasSexualIssues) {
            problems.push("Sexual Function Concerns");
        }
        
        // Check for lifestyle-related issues (Questions 16-25)
        const lifestyleAnswers = [
            appState.userAnswers[16], appState.userAnswers[17], appState.userAnswers[18],
            appState.userAnswers[19], appState.userAnswers[23], appState.userAnswers[24],
            appState.userAnswers[25]
        ];
        
        const hasLifestyleIssues = lifestyleAnswers.some(answer => 
            answer && (answer.includes("Sedentary") || answer.includes("> 12 hours") ||
                      answer.includes("None") || answer.includes("Regular smoker") ||
                      answer.includes("Poor") || answer.includes("High"))
        );
        
        if (hasLifestyleIssues) {
            problems.push("Lifestyle-Related Pelvic Stress");
        }
        
        // Check for medical conditions (Questions 41-50)
        const medicalAnswers = [
            appState.userAnswers[41], appState.userAnswers[42], appState.userAnswers[43],
            appState.userAnswers[44], appState.userAnswers[45], appState.userAnswers[46],
            appState.userAnswers[47], appState.userAnswers[48], appState.userAnswers[49],
            appState.userAnswers[50]
        ];
        
        const hasMedicalIssues = medicalAnswers.some(answer => 
            answer && (answer.includes("Frequent") || answer.includes("Chronic") ||
                      answer.includes("Severe") || answer.includes("Multiple") ||
                      answer.includes("Surgery"))
        );
        
        if (hasMedicalIssues) {
            problems.push("Medical Condition Impact");
        }
        
        // Check for substance abuse issues (Questions 51-55 for males)
        if (appState.gender === "Male") {
            const substanceAnswers = [
                appState.userAnswers[51], appState.userAnswers[52], appState.userAnswers[53],
                appState.userAnswers[54], appState.userAnswers[55]
            ];
            
            const hasSubstanceIssues = substanceAnswers.some(answer => 
                answer && (answer.includes("Often") || answer.includes("Regularly") ||
                          answer.includes("More than 5 years") || answer.includes("Daily") ||
                          answer.includes("Severe effects") || answer.includes("Significant problems"))
            );
            
            if (hasSubstanceIssues) {
                problems.push("Substance-Related Sexual Health Issues");
            }
        }
        
        // Check for masturbation habits issues (Questions 56-60)
        const masturbationAnswers = [
            appState.userAnswers[56], appState.userAnswers[57], appState.userAnswers[58],
            appState.userAnswers[59], appState.userAnswers[60]
        ];
        
        const hasMasturbationIssues = masturbationAnswers.some(answer => 
            answer && (answer.includes("Before 13 years") || answer.includes("More than 5 years") ||
                      answer.includes("Daily") || answer.includes("Daily or more") ||
                      answer.includes("Significant effect") || answer.includes("Major problem"))
        );
        
        if (hasMasturbationIssues) {
            problems.push("Masturbation Habits Concerns");
        }
        
        // Check for sexual health risks (Questions 61-65)
        const sexualHealthAnswers = [
            appState.userAnswers[61], appState.userAnswers[62], appState.userAnswers[63],
            appState.userAnswers[64], appState.userAnswers[65]
        ];
        
        const hasSexualHealthRisks = sexualHealthAnswers.some(answer => 
            answer && (answer.includes("10+") || answer.includes("Rarely") || 
                      answer.includes("Never") || answer.includes("Multiple times") ||
                      answer.includes("Chronic issue"))
        );
        
        if (hasSexualHealthRisks) {
            problems.push("Sexual Health Risk Factors");
        }
        
        // If no specific problems detected, add general maintenance
        if (problems.length === 0) {
            problems.push("General Pelvic Health Maintenance");
        }
        
        // Store in appState
        appState.identifiedProblems = problems;
        
        return problems;
    }

    function generateProblemDescription(problems) {
        if (problems.length === 0) return "No significant issues detected.";
        
        let description = "Primary Concerns Identified: ";
        description += problems.join(", ");
        
        // Add recommendations based on problems
        const recommendations = [];
        
        if (problems.includes("Urinary Incontinence") || problems.includes("Mild Bladder Control Issues")) {
            recommendations.push("Focus on stress incontinence exercises and bladder training.");
        }
        if (problems.includes("Pelvic Pain/Discomfort")) {
            recommendations.push("Incorporate relaxation and pain management techniques.");
        }
        if (problems.includes("Sexual Function Concerns")) {
            recommendations.push("Include intimacy and performance training exercises.");
        }
        if (problems.includes("Lifestyle-Related Pelvic Stress")) {
            recommendations.push("Address posture, stress management, and daily habits.");
        }
        if (problems.includes("Medical Condition Impact")) {
            recommendations.push("Consult with healthcare provider alongside exercise program.");
        }
        if (problems.includes("Substance-Related Sexual Health Issues")) {
            recommendations.push("Consider reducing substance use for optimal results.");
        }
        if (problems.includes("Masturbation Habits Concerns")) {
            recommendations.push("Moderate frequency for improved sexual performance.");
        }
        if (problems.includes("Sexual Health Risk Factors")) {
            recommendations.push("Practice safe sex and regular health checkups.");
        }
        if (problems.includes("General Pelvic Health Maintenance")) {
            recommendations.push("Maintain regular pelvic floor exercises for prevention.");
        }
        
        if (recommendations.length > 0) {
            description += ". Recommendations: " + recommendations.join(" ");
        }
        
        return description;
    }

    // ==================== INIT & STORAGE ====================
    function initApp() {
        const saved = localStorage.getItem('STI_KEGAL_V3_PRO');
        if (saved) {
            appState = JSON.parse(saved);
        }
        
        if (!appState.name) {
            document.getElementById('name-input-section').classList.add('active');
            document.getElementById('app-content').classList.add('hidden');
        } else {
            if (appState.assessmentComplete) {
                showExercisePlan();
            } else {
                startQuiz();
            }
        }
        updateReactor();
        updateProfileUI();
        renderDayLibrary();
    }

    function saveState() {
        localStorage.setItem('STI_KEGAL_V3_PRO', JSON.stringify(appState));
        updateReactor();
        updateProfileUI();
        renderDayLibrary();
    }

    // ==================== LOGIC ====================
    function submitName() {
        const val = document.getElementById('user-name-field').value.trim();
        if (val.length < 2) return alert("CALLSIGN INVALID.");
        
        appState.name = val;
        appState.startDate = new Date().toLocaleDateString();
        
        document.getElementById('name-input-section').classList.remove('active');
        document.getElementById('app-content').classList.remove('hidden');
        
        startQuiz();
        saveState();
    }

    function openModule(type) {
        document.querySelectorAll('.module-popup').forEach(el => {
            if(el.id !== 'name-input-section') el.classList.remove('active');
        });
        
        if (type === 'profile') {
            document.getElementById('module-profile').classList.add('active');
            updateProfileUI();
        } else if (type === 'stats') {
            document.getElementById('module-stats').classList.add('active');
            renderStats();
        } else if (type === 'progress') {
            document.getElementById('module-progress').classList.add('active');
            renderProgress();
            renderDayLibrary();
        }
    }

    function closeAllModules() {
        document.querySelectorAll('.module-popup').forEach(el => el.classList.remove('active'));
    }

    function updateProfileUI() {
        if(appState.name) {
            document.getElementById('profile-name').textContent = appState.name;
        }
        document.getElementById('profile-gender').textContent = appState.gender || "UNREGISTERED";
        document.getElementById('profile-level').textContent = appState.assessmentComplete ? calculateLevel(calculateScores()) : "PENDING";
        document.getElementById('profile-date').textContent = appState.startDate;
        
        // Update problems display
        const problemsElement = document.getElementById('profile-problems');
        if (appState.identifiedProblems && appState.identifiedProblems.length > 0) {
            let html = '';
            appState.identifiedProblems.forEach(problem => {
                html += `<div class="flex items-center gap-2 mb-1">
                    <span class="w-1.5 h-1.5 bg-[#FFD700] rounded-full"></span>
                    <span class="text-xs">${problem}</span>
                </div>`;
            });
            problemsElement.innerHTML = html;
        } else {
            problemsElement.innerHTML = '<span class="text-gray-500 text-xs">Awaiting analysis...</span>';
        }
    }

    function renderStats() {
        if (!appState.assessmentComplete) {
            document.getElementById('stats-text').textContent = "DATA UNAVAILABLE. COMPLETE ASSESSMENT.";
            return;
        }
        const s = calculateScores();
        document.getElementById('stats-focus').textContent = s.focus + "%";
        document.getElementById('stats-urgency').textContent = s.urgency + "%";
        document.getElementById('stats-program').textContent = s.program + "%";
        
        // Generate problem description for stats
        const problems = detectProblems();
        const problemDesc = generateProblemDescription(problems);
        
        document.getElementById('stats-text').textContent = `SUBJECT: ${appState.name}. ANALYSIS: ${calculateLevel(s)} PROTOCOL. ${problemDesc}`;
    }

    function renderProgress() {
        const totalDays = 30;
        const current = appState.currentDay;
        const totalCompletedExercises = Object.values(appState.dayProgress).reduce((acc, curr) => acc + curr.length, 0);
        
        const percent = Math.round((current / totalDays) * 100);
        
        const circle = document.getElementById('progress-ring');
        const radius = circle.r.baseVal.value;
        const circumference = radius * 2 * Math.PI;
        const offset = circumference - (percent / 100) * circumference;
        circle.style.strokeDashoffset = offset;
        
        document.getElementById('progress-percent').textContent = percent + "%";
        document.getElementById('progress-days').textContent = `${current} / ${totalDays}`;
        document.getElementById('progress-exercises').textContent = totalCompletedExercises;
        
        let phase = "INITIATION";
        if(current > 10) phase = "DEVELOPMENT";
        if(current > 20) phase = "MASTERY";
        document.getElementById('progress-phase').textContent = phase;
    }

    function renderDayLibrary() {
        const grid = document.getElementById('day-library-grid');
        let html = '';
        
        for (let day = 1; day <= 30; day++) {
            const isCompleted = appState.dayProgress[day] && appState.dayProgress[day].length > 0;
            const isCurrent = day === appState.currentDay;
            const isLocked = day > appState.currentDay;
            
            let btnClass = 'day-library-btn';
            if (isCompleted) btnClass += ' completed';
            if (isCurrent) btnClass += ' current';
            if (isLocked) btnClass += ' locked';
            
            html += `<button class="${btnClass}" ${!isLocked ? `onclick="openDayLibrary(${day})"` : ''}>${day}</button>`;
        }
        
        grid.innerHTML = html;
    }

    function openDayLibrary(day) {
        if (day > appState.currentDay) return;
        
        const dayExercises = appState.dayExercises[day] || [];
        if (dayExercises.length === 0) return;
        
        let html = `
            <div class="p-6 h-full flex flex-col">
                <h2 class="text-2xl font-cyber font-bold text-white mb-6 border-b border-white/10 pb-4 flex items-center justify-between">
                    <span>DAY ${day} LIBRARY</span>
                    <span class="text-xs font-mono-tech text-[#FFD700]">${appState.dayProgress[day]?.length || 0}/${dayExercises.length} COMPLETED</span>
                </h2>
                <div class="space-y-4 overflow-y-auto pr-2 flex-1">
        `;
        
        dayExercises.forEach((ex, idx) => {
            const isDone = appState.dayProgress[day]?.includes(ex.id) || false;
            
            html += `
                <div class="exercise-card p-4 rounded-2xl flex items-center gap-4 ${isDone ? 'completed' : ''}" onclick="playVideoFromLibrary('${ex.id}', ${day})">
                    <div class="w-10 h-10 rounded-xl flex items-center justify-center font-bold font-mono-tech text-base shadow-inner ${isDone ? 'bg-[#10b981] text-black shadow-none' : 'bg-white/5 text-white'}">
                        ${isDone ? '<i class="fas fa-check"></i>' : idx+1}
                    </div>
                    <div class="flex-1">
                        <h4 class="text-sm font-bold text-white font-cyber tracking-wide mb-1">${ex.name}</h4>
                        <div class="flex gap-3 text-[9px] text-gray-400 font-mono-tech">
                            <span class="bg-white/5 px-2 py-0.5 rounded border border-white/5"><i class="far fa-clock mr-1"></i>${ex.duration}</span>
                            <span class="bg-white/5 px-2 py-0.5 rounded border border-white/5"><i class="fas fa-repeat mr-1"></i>${ex.reps}</span>
                        </div>
                    </div>
                    <div class="w-8 h-8 rounded-full border border-[#FFD700]/50 flex items-center justify-center text-[#FFD700]">
                        <i class="fas fa-play text-xs ml-0.5"></i>
                    </div>
                </div>
            `;
        });
        
        html += `
                </div>
                <button onclick="closeAllModules()" class="mt-6 w-full btn-tech py-4 rounded-xl text-xs font-bold font-cyber text-white/40 hover:text-white uppercase tracking-widest">Close Library</button>
            </div>
        `;
        
        document.getElementById('module-progress').innerHTML = html;
    }

    function startQuiz() {
        document.getElementById('progress-section').classList.remove('hidden');
        document.getElementById('quiz-section').classList.remove('hidden');
        document.getElementById('main-view-section').classList.add('hidden');
        renderQuestion();
    }

    function renderQuestion() {
        if (appState.currentQuestion >= questions.length) {
            completeAssessment();
            return;
        }
        
        // Skip gender-specific questions
        let q = questions[appState.currentQuestion];
        while (q.skipIfGender && q.skipIfGender === appState.gender && appState.currentQuestion < questions.length) {
            appState.currentQuestion++;
            if (appState.currentQuestion >= questions.length) {
                completeAssessment();
                return;
            }
            q = questions[appState.currentQuestion];
        }
        
        document.getElementById('question-text').textContent = q.text;
        document.getElementById('question-counter').textContent = `${appState.currentQuestion + 1}/${questions.length}`;
        document.getElementById('progress-bar').style.width = `${((appState.currentQuestion)/questions.length)*100}%`;
        
        const con = document.getElementById('options-container');
        con.innerHTML = '';
        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = "w-full btn-tech p-5 rounded-2xl text-sm font-bold text-left text-white flex justify-between items-center group font-cyber tracking-wide transition-all hover:pl-7";
            btn.innerHTML = `<span>${opt}</span><i class="far fa-circle text-white/20 group-hover:text-[#FFD700]"></i>`;
            btn.onclick = () => handleAnswer(opt, q.id);
            con.appendChild(btn);
        });
    }

    function handleAnswer(ans, questionId) {
        const q = questions.find(q => q.id === questionId);
        
        // Store user answer
        appState.userAnswers[questionId] = ans;
        
        if (q.id === 1) appState.gender = ans;
        if(q.scoreMap && q.scoreMap[ans]) {
            appState.categoryScores[q.category] += q.scoreMap[ans];
        }
        appState.currentQuestion++;
        renderQuestion();
    }

    function calculateScores() {
        const focus = Math.min(100, (appState.categoryScores.demographic + appState.categoryScores.goals) * 2);
        const urgency = Math.min(100, appState.categoryScores.symptoms * 3);
        const program = Math.min(100, 50 + (focus/2));
        return { focus, urgency, program };
    }
    
    function calculateLevel(s) {
        if(s.urgency > 60) return "REHAB";
        if(s.focus > 70) return "ELITE";
        return "PRO";
    }

    function completeAssessment() {
        appState.assessmentComplete = true;
        document.getElementById('quiz-section').classList.add('hidden');
        document.getElementById('progress-section').classList.add('hidden');
        document.getElementById('main-view-section').classList.remove('hidden');
        
        const s = calculateScores();
        
        // Detect problems
        const problems = detectProblems();
        const problemDesc = generateProblemDescription(problems);
        
        document.getElementById('main-view-section').innerHTML = `
            <div class="animate-fade-in text-center pt-8 px-2">
                <div class="inline-block p-6 rounded-full border border-[#FFD700] bg-gradient-to-b from-[#FFD700]/20 to-black mb-6 shadow-[0_0_50px_rgba(255,215,0,0.2)]">
                    <i class="fas fa-check text-4xl text-[#FFD700] drop-shadow-[0_0_10px_rgba(255,215,0,0.8)]"></i>
                </div>
                <h2 class="text-3xl font-black text-white tracking-widest font-cyber mb-8">ANALYSIS COMPLETE</h2>
                
                <div class="grid grid-cols-3 gap-3 mb-8">
                    <div class="hud-box p-4 rounded-xl text-center"><div class="text-[9px] text-gray-500 font-bold mb-2 uppercase tracking-widest">FOCUS</div><div class="text-2xl font-mono-tech font-bold text-[#FFD700] drop-shadow-md">${s.focus}%</div></div>
                    <div class="hud-box p-4 rounded-xl text-center"><div class="text-[9px] text-gray-500 font-bold mb-2 uppercase tracking-widest">URGENCY</div><div class="text-2xl font-mono-tech font-bold text-[#ef4444] drop-shadow-md">${s.urgency}%</div></div>
                    <div class="hud-box p-4 rounded-xl text-center"><div class="text-[9px] text-gray-500 font-bold mb-2 uppercase tracking-widest">PRO</div><div class="text-2xl font-mono-tech font-bold text-[#06b6d4] drop-shadow-md">${s.program}%</div></div>
                </div>
                
                <!-- PROBLEMS DISPLAY IN ANALYSIS -->
                <div class="bg-gradient-to-br from-[#FFD700]/10 to-transparent border border-[#FFD700]/30 p-6 rounded-2xl mb-8 text-left">
                    <h3 class="text-xs font-bold text-[#FFD700] mb-3 uppercase tracking-widest font-cyber"><i class="fas fa-exclamation-triangle"></i> IDENTIFIED ISSUES</h3>
                    <div class="space-y-2">
                        ${problems.map(problem => `
                            <div class="flex items-center gap-3">
                                <span class="w-2 h-2 bg-[#FFD700] rounded-full animate-pulse"></span>
                                <span class="text-sm text-white font-mono-tech">${problem}</span>
                            </div>
                        `).join('')}
                    </div>
                    <p class="text-xs text-gray-300 font-mono-tech mt-4">${problemDesc}</p>
                </div>
                
                <button onclick="showExercisePlan()" class="w-full btn-primary-glow py-5 rounded-2xl text-sm uppercase tracking-widest font-cyber font-bold">
                    Initiate System <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        `;
        
        saveState();
    }

    function generateDay() {
        if (appState.dayExercises[appState.currentDay]) return;
        
        // Generate 5-7 exercises based on identified problems
        const dayEx = [];
        const problems = appState.identifiedProblems;
        
        // Always include 2-3 foundational exercises (core basics)
        dayEx.push(exerciseLibrary.foundational[Math.floor(Math.random() * 10)]);
        dayEx.push(exerciseLibrary.foundational[Math.floor(Math.random() * 10)]);
        dayEx.push(exerciseLibrary.foundational[Math.floor(Math.random() * 10)]);
        
        // Add problem-specific exercises based on identified issues (2-3 exercises)
        if (problems.includes("Urinary Incontinence") || problems.includes("Mild Bladder Control Issues")) {
            dayEx.push(exerciseLibrary.rehab[3]); // Urge Suppression Hold
            dayEx.push(exerciseLibrary.rehab[4]); // Stress Leak Guard
            dayEx.push(exerciseLibrary.functional[3]); // Cough Guard
        } else if (problems.includes("Pelvic Pain/Discomfort")) {
            dayEx.push(exerciseLibrary.rehab[5]); // Pelvic Relax Recovery
            dayEx.push(exerciseLibrary.rehab[9]); // Pain Ease Hold
            dayEx.push(exerciseLibrary.mindfulness[0]); // Body Awareness Hold
        } else if (problems.includes("Sexual Function Concerns")) {
            if (appState.gender === "Male") {
                dayEx.push(exerciseLibrary.sexual[0]); // Erection Strength Hold
                dayEx.push(exerciseLibrary.sexual[1]); // Ejaculation Control Pulse
                dayEx.push(exerciseLibrary.sexual[4]); // Power Squeeze Series
            } else {
                dayEx.push(exerciseLibrary.sexual[5]); // Tone & Tighten Hold
                dayEx.push(exerciseLibrary.sexual[6]); // Sensation Pulse
                dayEx.push(exerciseLibrary.sexual[7]); // Orgasm Control Cycle
            }
        } else if (problems.includes("Lifestyle-Related Pelvic Stress")) {
            dayEx.push(exerciseLibrary.functional[2]); // Sitting Control
            dayEx.push(exerciseLibrary.functional[9]); // Desk Micro Holds
            dayEx.push(exerciseLibrary.functional[6]); // Lift Support
        } else if (problems.includes("Medical Condition Impact")) {
            dayEx.push(exerciseLibrary.rehab[0]); // Gentle Activation Start
            dayEx.push(exerciseLibrary.rehab[5]); // Pelvic Relax Recovery
            dayEx.push(exerciseLibrary.rehab[9]); // Pain Ease Hold
        } else if (problems.includes("Substance-Related Sexual Health Issues")) {
            dayEx.push(exerciseLibrary.control[0]); // Elevator Control
            dayEx.push(exerciseLibrary.control[5]); // Segmented Control
            dayEx.push(exerciseLibrary.mindfulness[1]); // Breath Focus Hold
        } else if (problems.includes("Masturbation Habits Concerns")) {
            dayEx.push(exerciseLibrary.control[1]); // Stop Start Hold
            dayEx.push(exerciseLibrary.control[6]); // Rapid Control Switch
            dayEx.push(exerciseLibrary.sexual[appState.gender === "Male" ? 1 : 6]); // Control exercises
        } else {
            // General maintenance - add variety
            dayEx.push(exerciseLibrary.control[0]); // Elevator Control
            dayEx.push(exerciseLibrary.functional[0]); // Walking Kegels
            dayEx.push(exerciseLibrary.breathing[0]); // Diaphragmatic Sync
        }
        
        // Add 1-2 complementary exercises (breathing, mindfulness, or hybrid)
        const complementaryTypes = [exerciseLibrary.breathing, exerciseLibrary.mindfulness, exerciseLibrary.hybrid];
        const selectedType = complementaryTypes[Math.floor(Math.random() * complementaryTypes.length)];
        const randomExercise = selectedType[Math.floor(Math.random() * 10)];
        dayEx.push(randomExercise);
        
        // Ensure we have 5-7 exercises total (remove duplicates if any)
        const uniqueDayEx = [...new Map(dayEx.map(item => [item.id, item])).values()];
        
        // Trim to 5-7 exercises
        const targetCount = 5 + Math.floor(Math.random() * 3); // 5, 6, or 7 exercises
        appState.dayExercises[appState.currentDay] = uniqueDayEx.slice(0, Math.min(targetCount, uniqueDayEx.length));
        appState.dayProgress[appState.currentDay] = [];
    }

    function showExercisePlan() {
        document.getElementById('quiz-section').classList.add('hidden');
        document.getElementById('progress-section').classList.add('hidden');
        document.getElementById('main-view-section').classList.remove('hidden');
        
        generateDay();
        renderDay();
        updateReactor();
    }

    function renderDay() {
        const day = appState.currentDay;
        const list = appState.dayExercises[day];
        const done = appState.dayProgress[day] || [];
        
        let html = `
            <div class="flex justify-between items-end mb-6 border-b border-white/10 pb-4 sticky top-0 bg-[#030304]/80 backdrop-blur-md z-10 pt-2 px-1">
                <div>
                    <h2 class="text-xl font-bold text-white font-cyber tracking-wide">Daily Protocol</h2>
                    <div class="flex items-center gap-3 mt-1.5">
                        <span class="w-2 h-2 rounded-full bg-[#FFD700] animate-pulse shadow-[0_0_10px_#FFD700]"></span>
                        <span class="text-[11px] font-mono-tech text-[#FFD700]">DAY ${day.toString().padStart(2,'0')} / 30</span>
                    </div>
                </div>
                <div class="text-[10px] font-mono-tech text-gray-400 bg-white/5 px-3 py-1.5 rounded-lg border border-white/10 tracking-widest font-bold">${done.length}/${list.length} COMPLETED</div>
            </div>
            <div class="space-y-4 pb-8">
        `;
        
        list.forEach((ex, idx) => {
            const isDone = done.includes(ex.id);
            const isLocked = idx > done.length;
            const isCurrent = idx === done.length;
            
            html += `
                <div class="exercise-card p-5 rounded-2xl flex items-center gap-5 ${isLocked?'locked':''} ${isCurrent?'current':''} ${isDone?'completed':''}" ${!isLocked && !isDone ? `onclick="playVideo('${ex.id}', ${day})"` : ''}>
                    <div class="w-12 h-12 rounded-xl flex items-center justify-center font-bold font-mono-tech text-lg shadow-inner ${isDone ? 'bg-[#10b981] text-black shadow-none' : (isCurrent ? 'bg-[#FFD700] text-black shadow-[0_0_15px_rgba(255,215,0,0.5)]' : 'bg-white/5 text-white/20')}">
                        ${isDone ? '<i class="fas fa-check"></i>' : (isLocked ? '<i class="fas fa-lock"></i>' : idx+1)}
                    </div>
                    <div class="flex-1">
                        <h4 class="text-base font-bold text-white font-cyber tracking-wide mb-1">${ex.name}</h4>
                        <div class="flex gap-3 text-[10px] text-gray-400 font-mono-tech">
                            <span class="bg-white/5 px-2 py-0.5 rounded border border-white/5"><i class="far fa-clock mr-1"></i>${ex.duration}</span>
                            <span class="bg-white/5 px-2 py-0.5 rounded border border-white/5"><i class="fas fa-repeat mr-1"></i>${ex.reps}</span>
                        </div>
                    </div>
                    ${!isLocked && !isDone ? '<div class="w-8 h-8 rounded-full border border-[#FFD700]/50 flex items-center justify-center text-[#FFD700] animate-pulse"><i class="fas fa-play text-xs ml-0.5"></i></div>' : ''}
                    ${isLocked ? '<div class="w-8 h-8 flex items-center justify-center text-gray-600"><i class="fas fa-lock text-xs"></i></div>' : ''}
                </div>
            `;
        });
        
        html += `</div>`;
        
        // Add day completion message if all exercises done
        if (done.length === list.length && list.length > 0) {
            if (day < 30) {
                html += `
                    <div class="bg-gradient-to-br from-[#10b981]/20 to-transparent border border-[#10b981] p-6 rounded-2xl text-center mb-6">
                        <i class="fas fa-check-circle text-3xl text-[#10b981] mb-3"></i>
                        <h3 class="text-lg font-bold text-white font-cyber mb-2">DAY ${day} COMPLETE!</h3>
                        <p class="text-sm text-gray-300 font-mono-tech mb-4">All exercises completed. Ready to proceed?</p>
                        <button onclick="advanceToNextDay()" class="w-full btn-primary-glow py-4 rounded-xl text-sm font-bold font-cyber">
                            ADVANCE TO DAY ${day + 1} <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                `;
            } else {
                html += `
                    <div class="bg-gradient-to-br from-[#FFD700]/20 to-transparent border border-[#FFD700] p-6 rounded-2xl text-center mb-6">
                        <i class="fas fa-trophy text-3xl text-[#FFD700] mb-3"></i>
                        <h3 class="text-lg font-bold text-white font-cyber mb-2">30-DAY PROTOCOL COMPLETE!</h3>
                        <p class="text-sm text-gray-300 font-mono-tech mb-4">Congratulations! You've completed the full program.</p>
                        <button onclick="restartAssessment()" class="w-full btn-primary-glow py-4 rounded-xl text-sm font-bold font-cyber">
                            RESTART ASSESSMENT <i class="fas fa-redo ml-2"></i>
                        </button>
                    </div>
                `;
            }
        }
        
        document.getElementById('main-view-section').innerHTML = html;
    }

    function advanceToNextDay() {
        if (appState.currentDay < 30) {
            appState.currentDay++;
            generateDay();
            renderDay();
            updateReactor();
            saveState();
        } else {
            // Reset to assessment after 30 days
            appState.assessmentComplete = false;
            appState.currentQuestion = 0;
            appState.categoryScores = { demographic: 0, symptoms: 0, lifestyle: 0, sexual: 0, experience: 0, goals: 0, medical: 0 };
            appState.userAnswers = {};
            startQuiz();
            saveState();
        }
    }

    // ==================== DAILYMOTION VIDEO PLAYER LOGIC ====================
    let activeEx = null;
    let activeDay = null;
    let videoStarted = false;
    let videoProgress = 0;
    let videoCheckInterval = null;
    
    function playVideo(exId, day = appState.currentDay) {
        const ex = appState.dayExercises[day].find(e => e.id === exId);
        
        if (!ex) return;
        
        activeEx = ex;
        activeDay = day;
        videoStarted = false;
        videoProgress = 0;
        
        document.getElementById('video-title').textContent = ex.name;
        document.getElementById('video-description').textContent = ex.description || "Execute controlled contractions. Focus on breath work.";
        document.getElementById('video-duration').textContent = ex.duration;
        document.getElementById('video-reps').textContent = ex.reps;
        document.getElementById('video-category').textContent = ex.category;
        
        const frame = document.getElementById('video-frame');
        const thumbnailUrl = thumbnailImages[ex.thumbnail] || thumbnailImages["F1"];
        const videoCode = ex.videoCode || "x9x5uzi";
        
        frame.innerHTML = `
            <div class="dailymotion-iframe-container" id="dailymotion-container">
                <div id="dailymotion-thumbnail-container" class="relative w-full h-full">
                    <img src="${thumbnailUrl}" alt="${ex.name}" class="custom-video-thumbnail">
                    <div class="play-button-overlay" onclick="loadDailymotionVideo('${videoCode}')">
                        <i class="fas fa-play"></i>
                    </div>
                    <div class="video-duration-badge">${ex.duration}</div>
                </div>
            </div>
        `;
        
        document.getElementById('video-progress-fill').style.width = '0%';
        document.getElementById('video-time-current').textContent = '0:00';
        document.getElementById('video-time-total').textContent = '0:00';
        
        const completeBtn = document.getElementById('complete-btn');
        const completeBtnText = document.getElementById('complete-btn-text');
        const videoLoading = document.getElementById('video-loading');
        const repeatBtn = document.getElementById('repeat-btn');
        
        completeBtn.disabled = true;
        completeBtnText.textContent = 'PROTOCOL IN PROGRESS...';
        videoLoading.classList.remove('hidden');
        repeatBtn.disabled = true;
        
        document.getElementById('video-modal').classList.remove('hidden');
    }
    
    function playVideoFromLibrary(exId, day) {
        playVideo(exId, day);
    }

    function loadDailymotionVideo(videoCode) {
        const container = document.getElementById('dailymotion-container');
        const thumbnailContainer = document.getElementById('dailymotion-thumbnail-container');
        
        thumbnailContainer.classList.add('hidden');
        
        container.innerHTML = `
            <iframe 
                src="https://www.dailymotion.com/embed/video/${videoCode}?autoplay=1&controls=1&ui=start-screen-info-logo&ui-highlight=000000&ui-start-screen-info=true"
                frameborder="0" 
                allow="autoplay; fullscreen; picture-in-picture" 
                allowfullscreen
                id="dailymotion-iframe">
            </iframe>
        `;
        
        document.getElementById('video-loading').classList.add('hidden');
        document.getElementById('complete-btn').disabled = false;
        document.getElementById('complete-btn-text').textContent = 'COMPLETE & SYNC DATA';
        document.getElementById('repeat-btn').disabled = false;
        videoStarted = true;
        
        // Start checking video progress
        if (videoCheckInterval) clearInterval(videoCheckInterval);
        videoCheckInterval = setInterval(checkVideoProgress, 1000);
    }

    function checkVideoProgress() {
        // For Dailymotion, we'll simulate progress since we can't access the player API directly
        // In a real implementation, you would use Dailymotion's JavaScript API
        if (videoProgress < 100) {
            videoProgress += 0.5; // Simulate progress
            document.getElementById('video-progress-fill').style.width = `${videoProgress}%`;
            
            // Format time display (simulated)
            const totalSeconds = 180; // Assume 3 minute videos
            const currentSeconds = (videoProgress / 100) * totalSeconds;
            document.getElementById('video-time-current').textContent = formatTime(currentSeconds);
            document.getElementById('video-time-total').textContent = formatTime(totalSeconds);
            
            // Auto-enable complete button at 95% progress
            if (videoProgress >= 95 && !document.getElementById('complete-btn').disabled) {
                document.getElementById('complete-btn').disabled = false;
                document.getElementById('complete-btn-text').textContent = 'COMPLETE & SYNC DATA';
            }
        } else if (videoProgress >= 100) {
            clearInterval(videoCheckInterval);
            document.getElementById('complete-btn').disabled = false;
            document.getElementById('complete-btn-text').textContent = 'COMPLETE & SYNC DATA';
        }
    }

    function repeatVideo() {
        // For Dailymotion, we'll reload the iframe
        const iframe = document.getElementById('dailymotion-iframe');
        if (iframe) {
            const src = iframe.src;
            iframe.src = src.replace(/\?.*$/, '') + '?autoplay=1';
        }
        videoProgress = 0;
        document.getElementById('video-progress-fill').style.width = '0%';
    }

    function formatTime(time) {
        const minutes = Math.floor(time / 60);
        const seconds = Math.floor(time % 60);
        return `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    function markCurrentExerciseComplete() {
        if (!activeEx || !videoStarted) return;
        
        const day = activeDay || appState.currentDay;
        if (!appState.dayProgress[day].includes(activeEx.id)) {
            appState.dayProgress[day].push(activeEx.id);
        }

        closeVideoModal();
        renderDay();
        saveState();
    }

    function closeVideoModal() {
        if (videoCheckInterval) {
            clearInterval(videoCheckInterval);
            videoCheckInterval = null;
        }
        
        const iframe = document.getElementById('dailymotion-iframe');
        if (iframe) {
            iframe.src = '';
        }
        
        document.getElementById('video-modal').classList.add('hidden');
        document.getElementById('video-frame').innerHTML = '';
        activeEx = null;
        activeDay = null;
        videoStarted = false;
        videoProgress = 0;
        
        // Reset UI
        document.getElementById('complete-btn').disabled = true;
        document.getElementById('complete-btn-text').textContent = 'PROTOCOL IN PROGRESS...';
        document.getElementById('video-loading').classList.remove('hidden');
        document.getElementById('repeat-btn').disabled = true;
    }

    function updateReactor() {
        document.getElementById('core-day').innerText = appState.currentDay.toString().padStart(2, '0');
    }

    function restartAssessment() {
        document.getElementById('custom-alert-modal').classList.remove('hidden');
    }
    
    function confirmReset() {
        localStorage.removeItem('STI_KEGAL_V3_PRO');
        location.reload();
    }

    window.onload = initApp;
</script>
</body>
</html>
